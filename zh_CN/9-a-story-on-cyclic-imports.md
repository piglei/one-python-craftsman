# Python å·¥åŒ ï¼šä¸€ä¸ªå…³äºæ¨¡å—çš„å°æ•…äº‹

## å‰è¨€

> è¿™æ˜¯ â€œPython å·¥åŒ â€ç³»åˆ—çš„ç¬¬ 9 ç¯‡æ–‡ç« ã€‚[[æŸ¥çœ‹ç³»åˆ—æ‰€æœ‰æ–‡ç« ]](https://github.com/piglei/one-python-craftsman)

<div style="text-align: center; color: #999; margin: 14px 0 14px;font-size: 12px;">
<img src="https://www.zlovezl.cn/static/uploaded/2019/05/ricardo-gomez-angel-669574-unsplash_w1280.jpg" width="100%" />
</div>

æ¨¡å—ï¼ˆModuleï¼‰æ˜¯æˆ‘ä»¬ç”¨æ¥ç»„ç»‡ Python ä»£ç çš„åŸºæœ¬å•ä½ã€‚å¾ˆå¤šåŠŸèƒ½å¼ºå¤§çš„å¤æ‚ç«™ç‚¹ï¼Œéƒ½ç”±æˆç™¾ä¸Šåƒä¸ªç‹¬ç«‹æ¨¡å—å…±åŒç»„æˆã€‚

è™½ç„¶æ¨¡å—æœ‰ç€ä¸å¯æ›¿ä»£çš„ç”¨å¤„ï¼Œä½†å®ƒæœ‰æ—¶ä¹Ÿä¼šç»™æˆ‘ä»¬å¸¦æ¥éº»çƒ¦ã€‚æ¯”å¦‚ï¼Œå½“ä½ æ¥æ‰‹ä¸€ä¸ªæ–°é¡¹ç›®åï¼Œåˆšå±•å¼€é¡¹ç›®ç›®å½•ã€‚ç¬¬ä¸€çœ¼å°±çœ‹åˆ°äº†æ”€æé”™èŠ‚ã€éš¾ä»¥ç†è§£çš„æ¨¡å—ç»“æ„ï¼Œé‚£ä½ è‚¯å®šä¼šæƒ³ï¼š *â€œè¿™é¡¹ç›®ä¹Ÿå¤ªéš¾æäº†ã€‚â€* ğŸ˜‚

åœ¨è¿™ç¯‡æ–‡ç« é‡Œï¼Œæˆ‘å‡†å¤‡äº†ä¸€ä¸ªå’Œæ¨¡å—æœ‰å…³çš„å°æ•…äº‹ä¸ä½ åˆ†äº«ã€‚

## ä¸€ä¸ªå…³äºæ¨¡å—çš„å°æ•…äº‹

å° R æ˜¯ä¸€ä¸ªåˆšä»å­¦æ ¡æ¯•ä¸šçš„è®¡ç®—æœºä¸“ä¸šå­¦ç”Ÿã€‚åŠä¸ªæœˆå‰ï¼Œä»–é¢è¯•è¿›äº†ä¸€å®¶äº’è”ç½‘å…¬å¸åš Python å¼€å‘ï¼Œè´Ÿè´£ä¸€ä¸ªä¸ç”¨æˆ·æ´»åŠ¨ç§¯åˆ†æœ‰å…³çš„å°é¡¹ç›®ã€‚é¡¹ç›®çš„ä¸»è¦åŠŸèƒ½æ˜¯æŸ¥è¯¢ç«™ç‚¹æ´»è·ƒç”¨æˆ·ï¼Œå¹¶ä¸ºä»–ä»¬å‘é€æœ‰å…³æ´»åŠ¨ç§¯åˆ†çš„é€šçŸ¥ï¼š *â€œäº²çˆ±çš„ç”¨æˆ·ï¼Œæ‚¨å¥½ï¼Œæ‚¨å½“å‰çš„æ´»åŠ¨ç§¯åˆ†ä¸º xâ€*ã€‚

é¡¹ç›®ä¸»è¦ç”± `notify_users.py` è„šæœ¬å’Œ `fancy_site` åŒ…ç»„æˆï¼Œç»“æ„ä¸å„æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š

```text
â”œâ”€â”€ fancy_site
â”‚Â Â  â”œâ”€â”€ __init__.py
â”‚Â Â  â”œâ”€â”€ marketing.py        # ä¸å¸‚åœºæ´»åŠ¨æœ‰å…³çš„å†…å®¹
â”‚Â Â  â””â”€â”€ users.py            # ä¸ç”¨æˆ·æœ‰å…³çš„å†…å®¹
â””â”€â”€ notify_users.py     # è„šæœ¬ï¼šå‘é€ç§¯åˆ†é€šçŸ¥
```

æ–‡ä»¶ `notify_users.py`ï¼š

```python
from fancy_site.users import list_active_users
from fancy_site.marketing import query_user_points


def main():
    """è·å–æ‰€æœ‰çš„æ´»è·ƒç”¨æˆ·ï¼Œå°†ç§¯åˆ†æƒ…å†µå‘é€ç»™ä»–ä»¬"""
    users = get_active_users()
    points = list_user_points(users)
    for user in users:
        user.add_notification(... ...)
        #  <... å·²çœç•¥ ...>
```

æ–‡ä»¶ `fancy_site/users.py`ï¼š

```python
from typing import List


class User:
    # <... å·²çœç•¥ ...>

    def add_notification(self, message: str):
        """ä¸ºç”¨æˆ·å‘é€æ–°é€šçŸ¥"""
        pass


def list_active_users() -> List[User]:
    """æŸ¥è¯¢æ‰€æœ‰æ´»è·ƒç”¨æˆ·"""
    pass
```

æ–‡ä»¶ï¼š`fancy_site/marketing.py`ï¼š

```python
from typing import List
from .users import User


def query_user_points(users: List[User]) -> List[int]:
    """æ‰¹é‡æŸ¥è¯¢ç”¨æˆ·æ´»åŠ¨ç§¯åˆ†"""


def send_sms(phone_number: str, message: str):
    """ä¸ºæŸæ‰‹æœºå·å‘é€çŸ­ä¿¡"""
```

åªè¦åœ¨é¡¹ç›®ç›®å½•ä¸‹æ‰§è¡Œ `python notify_user.py`ï¼Œå°±èƒ½å®ç°ç»™æ‰€æœ‰æ´»è·ƒç”¨æˆ·å‘é€é€šçŸ¥ã€‚

### éœ€æ±‚å˜æ›´

ä½†æœ‰ä¸€å¤©ï¼Œäº§å“ç»ç†æ‰¾è¿‡æ¥è¯´ï¼Œå…‰ç»™ç”¨æˆ·å‘ç«™å†…ä¿¡é€šçŸ¥è¿˜ä¸å¤Ÿï¼Œå®¹æ˜“è¢«ç”¨æˆ·å¿½ç•¥ã€‚é™¤äº†ç«™å†…ä¿¡ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åŒæ—¶ç»™ç”¨æˆ·æ¨é€ä¸€æ¡çŸ­ä¿¡é€šçŸ¥ã€‚

ç¢ç£¨äº†äº”ç§’é’Ÿåï¼Œå° R è·Ÿäº§å“ç»ç†è¯´ï¼š*â€œè¿™ä¸ªéœ€æ±‚å¯ä»¥åšï¼â€*ã€‚æ¯•ç«Ÿç»™æ‰‹æœºå·å‘é€çŸ­ä¿¡çš„ `send_sms()` å‡½æ•°æ—©å°±å·²ç»æœ‰äººå†™å¥½äº†ã€‚ä»–åªè¦å…ˆç»™ `add_notification` æ–¹æ³•æ·»åŠ ä¸€ä¸ªå¯é€‰å‚æ•° `enable_sms=False`ï¼Œå½“ä¼ å€¼ä¸º `True` æ—¶è°ƒç”¨ `fancy_site.marketing` æ¨¡å—é‡Œçš„ `send_sms` å‡½æ•°å°±è¡Œã€‚

ä¸€åˆ‡å¬ä¸Šå»æ ¹æœ¬æ²¡æœ‰ä»€ä¹ˆéš¾åº¦å¯è¨€ï¼Œååˆ†é’Ÿåï¼Œå° R å°±æŠŠ `user.py` æ”¹æˆäº†ä¸‹é¢è¿™æ ·ï¼š

```python
# å¯¼å…¥ send_sms æ¨¡å—çš„å‘é€çŸ­ä¿¡å‡½æ•°
from .marketing import send_sms


class User:
    # <...> ç›¸å…³åˆå§‹åŒ–ä»£ç å·²çœç•¥

    def add_notification(self, message: str, enable_sms=False):
        """ä¸ºç”¨æˆ·æ·»åŠ æ–°é€šçŸ¥"""
        if enable_sms:
            send_sms(user.mobile_number, ... ...)
```

ä½†æ˜¯ï¼Œå½“ä»–ä¿®æ”¹å®Œä»£ç ï¼Œå†æ¬¡æ‰§è¡Œ `notify_users.py` è„šæœ¬æ—¶ï¼Œç¨‹åºå´æŠ¥é”™äº†ï¼š

```raw
Traceback (most recent call last):
  File "notify_users.py", line 2, in <module>
    from fancy_site.users import list_active_users
  File .../fancy_site/users.py", line 3, in <module>
    from .marketing import send_sms
  File ".../fancy_site/marketing.py", line 3, in <module>
    from .users import User
ImportError: cannot import name 'User' from 'fancy_site.users' (.../fancy_site/users.py)
```

é”™è¯¯ä¿¡æ¯è¯´ï¼Œæ— æ³•ä» `fancy_site.users` æ¨¡å—å¯¼å…¥ `User` å¯¹è±¡ã€‚

### è§£å†³ç¯å½¢ä¾èµ–é—®é¢˜

å° R ä»”ç»†åˆ†æäº†ä¸€ä¸‹é”™è¯¯ï¼Œå‘ç°é”™è¯¯æ˜¯å› ä¸º `users` ä¸ `marketing` æ¨¡å—ä¹‹é—´äº§ç”Ÿçš„ç¯å½¢ä¾èµ–å…³ç³»å¯¼è‡´çš„ã€‚

å½“ç¨‹åºåœ¨ `notify_users.py` æ–‡ä»¶å¯¼å…¥ `fancy_site.users` æ¨¡å—æ—¶ï¼Œ`users` æ¨¡å—å‘ç°è‡ªå·±éœ€è¦ä» `marketing` æ¨¡å—é‚£é‡Œå¯¼å…¥ `send_sms` å‡½æ•°ã€‚è€Œè§£é‡Šå™¨åœ¨åŠ è½½ `marketing` æ¨¡å—çš„è¿‡ç¨‹ä¸­ï¼Œåˆåè¿‡æ¥å‘ç°è‡ªå·±éœ€è¦ä¾èµ– `users` æ¨¡å—é‡Œé¢çš„ `User` å¯¹è±¡ã€‚

å¦‚æ­¤ä¸€æ¥ï¼Œæ•´ä¸ªæ¨¡å—ä¾èµ–å…³ç³»æˆä¸ºäº†ç¯çŠ¶ï¼Œç¨‹åºè‡ªç„¶ä¹Ÿå°±æ²¡æ³•æ‰§è¡Œä¸‹å»äº†ã€‚

![modules_before](https://www.zlovezl.cn/static/uploaded/2019/05/modules_before.png)

ä¸è¿‡ï¼Œæ²¡æœ‰ä»€ä¹ˆé—®é¢˜èƒ½å¤Ÿéš¾å€’ä¸€ä¸ªå¯ä»¥æ­£å¸¸è®¿é—® Google çš„ç¨‹åºå‘˜ã€‚å° R éšä¾¿ä¸Šç½‘ä¸€æœï¼Œå‘ç°è¿™æ ·çš„é—®é¢˜å¾ˆå¥½è§£å†³ã€‚å› ä¸º Python çš„ import è¯­å¥éå¸¸çµæ´»ï¼Œä»–åªéœ€è¦ **æŠŠåœ¨ users æ¨¡å—å†…å¯¼å…¥ send_sms å‡½æ•°çš„è¯­å¥æŒªåˆ° `add_notification` æ–¹æ³•å†…ï¼Œå»¶ç¼“ import è¯­å¥çš„æ‰§è¡Œå°±è¡Œå•¦ã€‚**

```python
class User:
    # <...> ç›¸å…³åˆå§‹åŒ–ä»£ç å·²çœç•¥

    def add_notification(self, message: str, send_sms=False):
        """ä¸ºç”¨æˆ·æ·»åŠ æ–°é€šçŸ¥"""
        # å»¶ç¼“ import è¯­å¥æ‰§è¡Œ
        from .marketing import send_sms
```

æ”¹åŠ¨ä¸€è¡Œä»£ç åï¼Œå¤§åŠŸå‘Šæˆã€‚å° R ç®€å•æµ‹è¯•åï¼Œå‘ç°ä¸€åˆ‡æ­£å¸¸ï¼Œç„¶åæŠŠä»£ç æ¨é€äº†ä¸Šå»ã€‚ä¸è¿‡å° R è¿˜æ²¡æ¥å¾—åŠä¸ºè‡ªå·±ç‚¹ä¸ªèµï¼Œæ„æ–™ä¹‹å¤–çš„äº‹æƒ…å‘ç”Ÿäº†ã€‚

è¿™æ®µæ˜æ˜å‡ ä¹å®Œç¾çš„ä»£ç æ”¹åŠ¨åœ¨ **Code Review** çš„æ—¶å€™è¢«å®¡è®¡äººå° C æ‹’ç»äº†ã€‚

### å° C çš„ç–‘é—®

å° R çš„åŒäº‹å° C æ˜¯ä¸€åæœ‰ç€å¤šå¹´ç»éªŒçš„ Python ç¨‹åºå‘˜ï¼Œä»–å¯¹å° R è¯´ï¼šâ€œä½¿ç”¨å»¶è¿Ÿ importï¼Œè™½ç„¶å¯ä»¥é©¬ä¸Šè§£å†³åŒ…å¯¼å…¥é—®é¢˜ã€‚ä½†è¿™ä¸ªå°é—®é¢˜èƒŒåéšè—äº†æ›´å¤šçš„ä¿¡æ¯ã€‚æ¯”å¦‚ï¼Œ**ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ send_sms å‡½æ•°ï¼Œæ˜¯ä¸æ˜¯å·²ç»ä¸é€‚åˆæ”¾åœ¨ marketing æ¨¡å—é‡Œäº†ï¼Ÿâ€**

è¢«å° C è¿™ä¹ˆä¸€é—®ï¼Œèªæ˜çš„å° R é©¬ä¸Šæ„è¯†åˆ°äº†é—®é¢˜æ‰€åœ¨ã€‚è¦åœ¨ `users` æ¨¡å—å†…å‘é€çŸ­ä¿¡ï¼Œé‡ç‚¹ä¸åœ¨äºç”¨å»¶è¿Ÿå¯¼å…¥è§£å†³ç¯å½¢ä¾èµ–ã€‚è€Œæ˜¯è¦ä»¥æ­¤ä¸ºå¥‘æœºï¼Œ**å‘ç°å½“å‰æ¨¡å—é—´ä¾èµ–å…³ç³»çš„ä¸åˆç†ï¼Œæ‹†åˆ†/åˆå¹¶æ¨¡å—ï¼Œåˆ›å»ºæ–°çš„åˆ†å±‚ä¸æŠ½è±¡ï¼Œæœ€ç»ˆæ¶ˆé™¤ç¯å½¢ä¾èµ–ã€‚**

è®¤è¯†æ¸…æ¥šé—®é¢˜åï¼Œä»–å¾ˆå¿«æäº¤äº†æ–°çš„ä»£ç ä¿®æ”¹ã€‚åœ¨æ–°ä»£ç ä¸­ï¼Œä»–åˆ›å»ºäº†ä¸€ä¸ªä¸“é—¨è´Ÿè´£é€šçŸ¥ä¸æ¶ˆæ¯ç±»çš„å·¥å…·æ¨¡å— `msg_utils`ï¼Œç„¶åæŠŠ `send_sms` å‡½æ•°æŒªåˆ°äº†é‡Œé¢ã€‚ä¹‹å `users` æ¨¡å—å†…å°±å¯ä»¥æ¯«æ— å›°éš¾çš„ä» `msg_utils` æ¨¡å—ä¸­å¯¼å…¥ `send_sms` å‡½æ•°äº†ã€‚

```python
from .msg_utils import send_sms
```

æ–°çš„æ¨¡å—ä¾èµ–å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![modules_afte](https://www.zlovezl.cn/static/uploaded/2019/05/modules_after.png)

åœ¨æ–°çš„æ¨¡å—ç»“æ„ä¸­ï¼Œæ•´ä¸ªé¡¹ç›®è¢«æ•´é½çš„åˆ†ä¸ºä¸‰å±‚ï¼Œæ¨¡å—é—´çš„ä¾èµ–å…³ç³»ä¹Ÿå˜å¾—åªæœ‰**å•å‘æµåŠ¨**ã€‚ä¹‹å‰åœ¨å‡½æ•°å†…éƒ¨ `import` çš„â€œå»¶è¿Ÿå¯¼å…¥â€æŠ€å·§ï¼Œè‡ªç„¶ä¹Ÿå°±æ²¡æœ‰ç”¨æ­¦ä¹‹åœ°äº†ã€‚

å° R ä¿®æ”¹åçš„ä»£ç è·å¾—äº†å¤§å®¶çš„è®¤å¯ï¼Œå¾ˆå¿«å°±è¢«åˆå¹¶åˆ°äº†ä¸»åˆ†æ”¯ã€‚æ•…äº‹æš‚å‘Šä¸€æ®µè½ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•…äº‹å‘Šè¯‰äº†æˆ‘ä»¬ä»€ä¹ˆé“ç†å‘¢ï¼Ÿ

## æ€»ç»“

æ¨¡å—é—´çš„å¾ªç¯ä¾èµ–æ˜¯ä¸€ä¸ªåœ¨å¤§å‹ Python é¡¹ç›®ä¸­å¾ˆå¸¸è§çš„é—®é¢˜ï¼Œè¶Šå¤æ‚çš„é¡¹ç›®è¶Šå®¹æ˜“ç¢°åˆ°è¿™ä¸ªé—®é¢˜ã€‚å½“æˆ‘ä»¬åœ¨å‚ä¸è¿™äº›é¡¹ç›®æ—¶ï¼Œ**å¦‚æœå¯¹æ¨¡å—ç»“æ„ã€åˆ†å±‚ã€æŠ½è±¡ç¼ºå°‘åº”æœ‰çš„é‡è§†ã€‚é‚£ä¹ˆé¡¹ç›®å¾ˆå®¹æ˜“å°±ä¼šæ…¢æ…¢å˜å¾—å¤æ‚æ— æ¯”ã€éš¾ä»¥ç»´æŠ¤ã€‚**

æ‰€ä»¥ï¼Œåˆç†çš„æ¨¡å—ç»“æ„ä¸åˆ†å±‚éå¸¸é‡è¦ã€‚å®ƒå¯ä»¥å¤§å¤§é™ä½å¼€å‘äººå‘˜çš„å¿ƒæ™ºè´Ÿæ‹…å’Œé¡¹ç›®ç»´æŠ¤æˆæœ¬ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä¸ºä»€ä¹ˆè¦å’Œä½ åˆ†äº«è¿™ä¸ªç®€å•æ•…äº‹çš„åŸå› ã€‚â€œåœ¨å‡½æ•°å†…å»¶è¿Ÿ importâ€ çš„åšæ³•å½“ç„¶æ²¡æœ‰é”™ï¼Œä½†æˆ‘ä»¬æ›´åº”è¯¥å…³æ³¨çš„æ˜¯ï¼š**æ•´ä¸ªé¡¹ç›®å†…çš„æ¨¡å—ä¾èµ–å…³ç³»ä¸åˆ†å±‚æ˜¯å¦åˆç†ã€‚**

æœ€åï¼Œè®©æˆ‘ä»¬å†å°è¯•ä» å° R çš„æ•…äº‹é‡Œå¼ºè¡Œæ€»ç»“å‡ºå‡ ä¸ªé“ç†å§ï¼š

- åˆç†çš„æ¨¡å—ç»“æ„ä¸åˆ†å±‚å¯ä»¥é™ä½é¡¹ç›®çš„å¼€å‘ç»´æŠ¤æˆæœ¬
- åˆç†çš„æ¨¡å—ç»“æ„ä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œåº”è¯¥éšç€é¡¹ç›®å‘å±•è°ƒæ•´
- é‡åˆ°é—®é¢˜æ—¶ï¼Œä¸è¦é€‰**â€œç®€å•ä½†æœ‰ç¼ºé™·â€**çš„é‚£ä¸ªæ–¹æ¡ˆï¼Œè¦é€‰**â€œéº»çƒ¦ä½†æ­£ç¡®â€**çš„é‚£ä¸ª
- æ•´ä¸ªé¡¹ç›®å†…çš„æ¨¡å—é—´ä¾èµ–å…³ç³»æµå‘ï¼Œåº”è¯¥æ˜¯å•å‘çš„ï¼Œä¸èƒ½æœ‰ç¯å½¢ä¾èµ–å­˜åœ¨

çœ‹å®Œæ–‡ç« çš„ä½ ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆæƒ³åæ§½çš„ï¼Ÿè¯·ç•™è¨€æˆ–è€…åœ¨ [é¡¹ç›® Github Issues](https://github.com/piglei/one-python-craftsman) å‘Šè¯‰æˆ‘å§ã€‚

[>>>ä¸‹ä¸€ç¯‡ã€10.åšä¸€ä¸ªç²¾é€šè§„åˆ™çš„ç©å®¶ã€‘](10-a-good-player-know-the-rules.md)

[<<<ä¸Šä¸€ç¯‡ã€8.ä½¿ç”¨è£…é¥°å™¨çš„æŠ€å·§ã€‘](8-tips-on-decorators.md)

## é™„å½•

- é¢˜å›¾æ¥æº: Photo by Ricardo Gomez Angel on Unsplash
- æ›´å¤šç³»åˆ—æ–‡ç« åœ°å€ï¼šhttps://github.com/piglei/one-python-craftsman

ç³»åˆ—å…¶ä»–æ–‡ç« ï¼š

- [æ‰€æœ‰æ–‡ç« ç´¢å¼• [Github]](https://github.com/piglei/one-python-craftsman)
- [Python å·¥åŒ ï¼šç¼–å†™æ¡ä»¶åˆ†æ”¯ä»£ç çš„æŠ€å·§](https://www.zlovezl.cn/articles/python-else-block-secrets/)
- [Python å·¥åŒ ï¼šå¼‚å¸¸å¤„ç†çš„ä¸‰ä¸ªå¥½ä¹ æƒ¯](https://www.zlovezl.cn/articles/three-rituals-of-exceptions-handling/)
- [Python å·¥åŒ ï¼šç¼–å†™åœ°é“å¾ªç¯çš„ä¸¤ä¸ªå»ºè®®](https://www.zlovezl.cn/articles/two-tips-on-loop-writing/)



