# Python å·¥åŒ ï¼šä¸€å€‹é—œæ–¼æ¨¡çµ„çš„å°æ•…äº‹

## å‰è¨€

> é€™æ˜¯ â€œPython å·¥åŒ â€ç³»åˆ—çš„ç¬¬ 9 ç¯‡æ–‡ç« ã€‚[[æª¢è¦–ç³»åˆ—æ‰€æœ‰æ–‡ç« ]](https://github.com/piglei/one-python-craftsman)

<div style="text-align: center; color: #999; margin: 14px 0 14px;font-size: 12px;">
<img src="https://www.zlovezl.cn/static/uploaded/2019/05/ricardo-gomez-angel-669574-unsplash_w1280.jpg" width="100%" />
</div>

æ¨¡çµ„ï¼ˆModuleï¼‰æ˜¯æˆ‘å€‘ç”¨ä¾†çµ„ç¹” Python ç¨‹å¼ç¢¼çš„åŸºæœ¬å–®ä½ã€‚å¾ˆå¤šåŠŸèƒ½å¼·å¤§çš„è¤‡é›œç«™é»ï¼Œéƒ½ç”±æˆç™¾ä¸Šåƒå€‹ç¨ç«‹æ¨¡çµ„å…±åŒçµ„æˆã€‚

é›–ç„¶æ¨¡çµ„æœ‰è‘—ä¸å¯æ›¿ä»£çš„ç”¨è™•ï¼Œä½†å®ƒæœ‰æ™‚ä¹Ÿæœƒçµ¦æˆ‘å€‘å¸¶ä¾†éº»ç…©ã€‚æ¯”å¦‚ï¼Œç•¶ä½ æ¥æ‰‹ä¸€å€‹æ–°å°ˆæ¡ˆå¾Œï¼Œå‰›å±•é–‹å°ˆæ¡ˆç›®éŒ„ã€‚ç¬¬ä¸€çœ¼å°±çœ‹åˆ°äº†æ”€æéŒ¯ç¯€ã€é›£ä»¥ç†è§£çš„æ¨¡çµ„çµæ§‹ï¼Œé‚£ä½ è‚¯å®šæœƒæƒ³ï¼š *â€œé€™å°ˆæ¡ˆä¹Ÿå¤ªé›£æäº†ã€‚â€* ğŸ˜‚

åœ¨é€™ç¯‡æ–‡ç« è£¡ï¼Œæˆ‘æº–å‚™äº†ä¸€å€‹å’Œæ¨¡çµ„æœ‰é—œçš„å°æ•…äº‹èˆ‡ä½ åˆ†äº«ã€‚

## ä¸€å€‹é—œæ–¼æ¨¡çµ„çš„å°æ•…äº‹

å° R æ˜¯ä¸€å€‹å‰›å¾å­¸æ ¡ç•¢æ¥­çš„è¨ˆç®—æ©Ÿå°ˆæ¥­å­¸ç”Ÿã€‚åŠå€‹æœˆå‰ï¼Œä»–é¢è©¦é€²äº†ä¸€å®¶ç¶²éš›ç¶²è·¯å…¬å¸åš Python é–‹ç™¼ï¼Œè² è²¬ä¸€å€‹èˆ‡ä½¿ç”¨è€…æ´»å‹•ç©åˆ†æœ‰é—œçš„å°å°ˆæ¡ˆã€‚å°ˆæ¡ˆçš„ä¸»è¦åŠŸèƒ½æ˜¯æŸ¥è©¢ç«™é»æ´»èºä½¿ç”¨è€…ï¼Œä½µç‚ºä»–å€‘å‚³é€æœ‰é—œæ´»å‹•ç©åˆ†çš„é€šçŸ¥ï¼š *â€œè¦ªæ„›çš„ä½¿ç”¨è€…ï¼Œæ‚¨å¥½ï¼Œæ‚¨ç•¶å‰çš„æ´»å‹•ç©åˆ†ç‚º xâ€*ã€‚

å°ˆæ¡ˆä¸»è¦ç”± `notify_users.py` æŒ‡ä»¤ç¢¼å’Œ `fancy_site` åŒ…çµ„æˆï¼Œçµæ§‹èˆ‡å„æª”æ¡ˆå…§å®¹å¦‚ä¸‹ï¼š

```text
â”œâ”€â”€ fancy_site
â”‚Â Â  â”œâ”€â”€ __init__.py
â”‚Â Â  â”œâ”€â”€ marketing.py        # èˆ‡å¸‚å ´æ´»å‹•æœ‰é—œçš„å…§å®¹
â”‚Â Â  â””â”€â”€ users.py            # èˆ‡ä½¿ç”¨è€…æœ‰é—œçš„å…§å®¹
â””â”€â”€ notify_users.py     # æŒ‡ä»¤ç¢¼ï¼šå‚³é€ç©åˆ†é€šçŸ¥
```

æª”æ¡ˆ `notify_users.py`ï¼š

```python
from fancy_site.users import list_active_users
from fancy_site.marketing import query_user_points


def main():
    """ç²å–æ‰€æœ‰çš„æ´»èºä½¿ç”¨è€…ï¼Œå°‡ç©åˆ†æƒ…æ³å‚³é€çµ¦ä»–å€‘"""
    users = get_active_users()
    points = list_user_points(users)
    for user in users:
        user.add_notification(... ...)
        #  <... å·²çœç•¥ ...>
```

æª”æ¡ˆ `fancy_site/users.py`ï¼š

```python
from typing import List


class User:
    # <... å·²çœç•¥ ...>

    def add_notification(self, message: str):
        """ç‚ºä½¿ç”¨è€…å‚³é€æ–°é€šçŸ¥"""
        pass


def list_active_users() -> List[User]:
    """æŸ¥è©¢æ‰€æœ‰æ´»èºä½¿ç”¨è€…"""
    pass
```

æª”æ¡ˆï¼š`fancy_site/marketing.py`ï¼š

```python
from typing import List
from .users import User


def query_user_points(users: List[User]) -> List[int]:
    """æ‰¹æ¬¡æŸ¥è©¢ä½¿ç”¨è€…æ´»å‹•ç©åˆ†"""


def send_sms(phone_number: str, message: str):
    """ç‚ºæŸæ‰‹æ©Ÿè™Ÿå‚³é€ç°¡è¨Š"""
```

åªè¦åœ¨å°ˆæ¡ˆç›®éŒ„ä¸‹åŸ·è¡Œ `python notify_user.py`ï¼Œå°±èƒ½å¯¦ç¾çµ¦æ‰€æœ‰æ´»èºä½¿ç”¨è€…å‚³é€é€šçŸ¥ã€‚

### éœ€æ±‚è®Šæ›´

ä½†æœ‰ä¸€å¤©ï¼Œç”¢å“ç¶“ç†æ‰¾éä¾†èªªï¼Œå…‰çµ¦ä½¿ç”¨è€…ç™¼ç«™å…§ä¿¡é€šçŸ¥é‚„ä¸å¤ ï¼Œå®¹æ˜“è¢«ä½¿ç”¨è€…å¿½ç•¥ã€‚é™¤äº†ç«™å…§ä¿¡ä»¥å¤–ï¼Œæˆ‘å€‘é‚„éœ€è¦åŒæ™‚çµ¦ä½¿ç”¨è€…æ¨é€ä¸€æ¢ç°¡è¨Šé€šçŸ¥ã€‚

ç¢ç£¨äº†äº”ç§’é˜å¾Œï¼Œå° R è·Ÿç”¢å“ç¶“ç†èªªï¼š*â€œé€™å€‹éœ€æ±‚å¯ä»¥åšï¼â€*ã€‚ç•¢ç«Ÿçµ¦æ‰‹æ©Ÿè™Ÿå‚³é€ç°¡è¨Šçš„ `send_sms()` å‡½å¼æ—©å°±å·²ç¶“æœ‰äººå¯«å¥½äº†ã€‚ä»–åªè¦å…ˆçµ¦ `add_notification` æ–¹æ³•æ–°å¢ä¸€å€‹å¯é¸å¼•æ•¸ `enable_sms=False`ï¼Œç•¶å‚³å€¼ç‚º `True` æ™‚å‘¼å« `fancy_site.marketing` æ¨¡çµ„è£¡çš„ `send_sms` å‡½å¼å°±è¡Œã€‚

ä¸€åˆ‡è½ä¸Šå»æ ¹æœ¬æ²’æœ‰ä»€éº¼é›£åº¦å¯è¨€ï¼Œååˆ†é˜å¾Œï¼Œå° R å°±æŠŠ `user.py` æ”¹æˆäº†ä¸‹é¢é€™æ¨£ï¼š

```python
# åŒ¯å…¥ send_sms æ¨¡çµ„çš„å‚³é€ç°¡è¨Šå‡½å¼
from .marketing import send_sms


class User:
    # <...> ç›¸é—œåˆå§‹åŒ–ç¨‹å¼ç¢¼å·²çœç•¥

    def add_notification(self, message: str, enable_sms=False):
        """ç‚ºä½¿ç”¨è€…æ–°å¢æ–°é€šçŸ¥"""
        if enable_sms:
            send_sms(user.mobile_number, ... ...)
```

ä½†æ˜¯ï¼Œç•¶ä»–ä¿®æ”¹å®Œç¨‹å¼ç¢¼ï¼Œå†æ¬¡åŸ·è¡Œ `notify_users.py` æŒ‡ä»¤ç¢¼æ™‚ï¼Œç¨‹å¼å»å ±éŒ¯äº†ï¼š

```raw
Traceback (most recent call last):
  File "notify_users.py", line 2, in <module>
    from fancy_site.users import list_active_users
  File .../fancy_site/users.py", line 3, in <module>
    from .marketing import send_sms
  File ".../fancy_site/marketing.py", line 3, in <module>
    from .users import User
ImportError: cannot import name 'User' from 'fancy_site.users' (.../fancy_site/users.py)
```

éŒ¯èª¤è³‡è¨Šèªªï¼Œç„¡æ³•å¾ `fancy_site.users` æ¨¡çµ„åŒ¯å…¥ `User` ç‰©ä»¶ã€‚

### è§£æ±ºç’°å½¢ä¾è³´å•é¡Œ

å° R ä»”ç´°åˆ†æäº†ä¸€ä¸‹éŒ¯èª¤ï¼Œç™¼ç¾éŒ¯èª¤æ˜¯å› ç‚º `users` èˆ‡ `marketing` æ¨¡çµ„ä¹‹é–“ç”¢ç”Ÿçš„ç’°å½¢ä¾è³´é—œä¿‚å°è‡´çš„ã€‚

ç•¶ç¨‹å¼åœ¨ `notify_users.py` æª”æ¡ˆåŒ¯å…¥ `fancy_site.users` æ¨¡çµ„æ™‚ï¼Œ`users` æ¨¡çµ„ç™¼ç¾è‡ªå·±éœ€è¦å¾ `marketing` æ¨¡çµ„é‚£è£¡åŒ¯å…¥ `send_sms` å‡½å¼ã€‚è€Œç›´è­¯å™¨åœ¨è¼‰å…¥ `marketing` æ¨¡çµ„çš„éç¨‹ä¸­ï¼Œåˆåéä¾†ç™¼ç¾è‡ªå·±éœ€è¦ä¾è³´ `users` æ¨¡çµ„è£¡é¢çš„ `User` ç‰©ä»¶ã€‚

å¦‚æ­¤ä¸€ä¾†ï¼Œæ•´å€‹æ¨¡çµ„ä¾è³´é—œä¿‚æˆç‚ºäº†ç’°ç‹€ï¼Œç¨‹å¼è‡ªç„¶ä¹Ÿå°±æ²’æ³•åŸ·è¡Œä¸‹å»äº†ã€‚

![modules_before](https://www.zlovezl.cn/static/uploaded/2019/05/modules_before.png)

ä¸éï¼Œæ²’æœ‰ä»€éº¼å•é¡Œèƒ½å¤ é›£å€’ä¸€å€‹å¯ä»¥æ­£å¸¸è¨ªå• Google çš„ç¨‹å¼è¨­è¨ˆå¸«ã€‚å° R éš¨ä¾¿ä¸Šç¶²ä¸€æœï¼Œç™¼ç¾é€™æ¨£çš„å•é¡Œå¾ˆå¥½è§£æ±ºã€‚å› ç‚º Python çš„ import èªå¥éå¸¸éˆæ´»ï¼Œä»–åªéœ€è¦ **æŠŠåœ¨ users æ¨¡çµ„å…§åŒ¯å…¥ send_sms å‡½å¼çš„èªå¥æŒªåˆ° `add_notification` æ–¹æ³•å…§ï¼Œå»¶ç·© import èªå¥çš„åŸ·è¡Œå°±è¡Œå•¦ã€‚**

```python
class User:
    # <...> ç›¸é—œåˆå§‹åŒ–ç¨‹å¼ç¢¼å·²çœç•¥

    def add_notification(self, message: str, send_sms=False):
        """ç‚ºä½¿ç”¨è€…æ–°å¢æ–°é€šçŸ¥"""
        # å»¶ç·© import èªå¥åŸ·è¡Œ
        from .marketing import send_sms
```

æ”¹å‹•ä¸€è¡Œç¨‹å¼ç¢¼å¾Œï¼Œå¤§åŠŸå‘Šæˆã€‚å° R ç°¡å–®æ¸¬è©¦å¾Œï¼Œç™¼ç¾ä¸€åˆ‡æ­£å¸¸ï¼Œç„¶å¾ŒæŠŠç¨‹å¼ç¢¼æ¨é€äº†ä¸Šå»ã€‚ä¸éå° R é‚„æ²’ä¾†å¾—åŠç‚ºè‡ªå·±é»å€‹è´Šï¼Œæ„æ–™ä¹‹å¤–çš„äº‹æƒ…ç™¼ç”Ÿäº†ã€‚

é€™æ®µæ˜æ˜å¹¾ä¹å®Œç¾çš„ç¨‹å¼ç¢¼æ”¹å‹•åœ¨ **Code Review** çš„æ™‚å€™è¢«å¯©è¨ˆäººå° C æ‹’çµ•äº†ã€‚

### å° C çš„ç–‘å•

å° R çš„åŒäº‹å° C æ˜¯ä¸€åæœ‰è‘—å¤šå¹´ç¶“é©—çš„ Python ç¨‹å¼è¨­è¨ˆå¸«ï¼Œä»–å°å° R èªªï¼šâ€œä½¿ç”¨å»¶é² importï¼Œé›–ç„¶å¯ä»¥é¦¬ä¸Šè§£æ±ºåŒ…åŒ¯å…¥å•é¡Œã€‚ä½†é€™å€‹å°å•é¡ŒèƒŒå¾Œéš±è—äº†æ›´å¤šçš„è³‡è¨Šã€‚æ¯”å¦‚ï¼Œ**ä½ æœ‰æ²’æœ‰æƒ³é send_sms å‡½å¼ï¼Œæ˜¯ä¸æ˜¯å·²ç¶“ä¸é©åˆæ”¾åœ¨ marketing æ¨¡çµ„è£¡äº†ï¼Ÿâ€**

è¢«å° C é€™éº¼ä¸€å•ï¼Œè°æ˜çš„å° R é¦¬ä¸Šæ„è­˜åˆ°äº†å•é¡Œæ‰€åœ¨ã€‚è¦åœ¨ `users` æ¨¡çµ„å…§å‚³é€ç°¡è¨Šï¼Œé‡é»ä¸åœ¨æ–¼ç”¨å»¶é²åŒ¯å…¥è§£æ±ºç’°å½¢ä¾è³´ã€‚è€Œæ˜¯è¦ä»¥æ­¤ç‚ºå¥‘æ©Ÿï¼Œ**ç™¼ç¾ç•¶å‰æ¨¡çµ„é–“ä¾è³´é—œä¿‚çš„ä¸åˆç†ï¼Œæ‹†åˆ†/åˆä½µæ¨¡çµ„ï¼Œå»ºç«‹æ–°çš„åˆ†å±¤èˆ‡æŠ½è±¡ï¼Œæœ€çµ‚æ¶ˆé™¤ç’°å½¢ä¾è³´ã€‚**

èªè­˜æ¸…æ¥šå•é¡Œå¾Œï¼Œä»–å¾ˆå¿«æäº¤äº†æ–°çš„ç¨‹å¼ç¢¼ä¿®æ”¹ã€‚åœ¨æ–°ç¨‹å¼ç¢¼ä¸­ï¼Œä»–å»ºç«‹äº†ä¸€å€‹å°ˆé–€è² è²¬é€šçŸ¥èˆ‡è¨Šæ¯é¡çš„å·¥å…·æ¨¡çµ„ `msg_utils`ï¼Œç„¶å¾ŒæŠŠ `send_sms` å‡½å¼æŒªåˆ°äº†è£¡é¢ã€‚ä¹‹å¾Œ `users` æ¨¡çµ„å…§å°±å¯ä»¥æ¯«ç„¡å›°é›£çš„å¾ `msg_utils` æ¨¡çµ„ä¸­åŒ¯å…¥ `send_sms` å‡½æ•¸äº†ã€‚

```python
from .msg_utils import send_sms
```

æ–°çš„æ¨¡çµ„ä¾è³´é—œä¿‚å¦‚ä¸‹åœ–æ‰€ç¤ºï¼š

![modules_afte](https://www.zlovezl.cn/static/uploaded/2019/05/modules_after.png)

åœ¨æ–°çš„æ¨¡çµ„çµæ§‹ä¸­ï¼Œæ•´å€‹å°ˆæ¡ˆè¢«æ•´é½Šçš„åˆ†ç‚ºä¸‰å±¤ï¼Œæ¨¡çµ„é–“çš„ä¾è³´é—œä¿‚ä¹Ÿè®Šå¾—åªæœ‰**å–®å‘æµå‹•**ã€‚ä¹‹å‰åœ¨å‡½å¼å…§éƒ¨ `import` çš„â€œå»¶é²åŒ¯å…¥â€æŠ€å·§ï¼Œè‡ªç„¶ä¹Ÿå°±æ²’æœ‰ç”¨æ­¦ä¹‹åœ°äº†ã€‚

å° R ä¿®æ”¹å¾Œçš„ç¨‹å¼ç¢¼ç²å¾—äº†å¤§å®¶çš„èªå¯ï¼Œå¾ˆå¿«å°±è¢«åˆä½µåˆ°äº†ä¸»åˆ†æ”¯ã€‚æ•…äº‹æš«å‘Šä¸€æ®µè½ï¼Œé‚£éº¼é€™å€‹æ•…äº‹å‘Šè¨´äº†æˆ‘å€‘ä»€éº¼é“ç†å‘¢ï¼Ÿ

## ç¸½çµ

æ¨¡çµ„é–“çš„è¿´åœˆä¾è³´æ˜¯ä¸€å€‹åœ¨å¤§å‹ Python å°ˆæ¡ˆä¸­å¾ˆå¸¸è¦‹çš„å•é¡Œï¼Œè¶Šè¤‡é›œçš„å°ˆæ¡ˆè¶Šå®¹æ˜“ç¢°åˆ°é€™å€‹å•é¡Œã€‚ç•¶æˆ‘å€‘åœ¨åƒèˆ‡é€™äº›å°ˆæ¡ˆæ™‚ï¼Œ**å¦‚æœå°æ¨¡çµ„çµæ§‹ã€åˆ†å±¤ã€æŠ½è±¡ç¼ºå°‘æ‡‰æœ‰çš„é‡è¦–ã€‚é‚£éº¼å°ˆæ¡ˆå¾ˆå®¹æ˜“å°±æœƒæ…¢æ…¢è®Šå¾—è¤‡é›œç„¡æ¯”ã€é›£ä»¥ç¶­è­·ã€‚**

æ‰€ä»¥ï¼Œåˆç†çš„æ¨¡çµ„çµæ§‹èˆ‡åˆ†å±¤éå¸¸é‡è¦ã€‚å®ƒå¯ä»¥å¤§å¤§é™ä½é–‹ç™¼äººå“¡çš„å¿ƒæ™ºè² æ“”å’Œå°ˆæ¡ˆç¶­è­·æˆæœ¬ã€‚é€™ä¹Ÿæ˜¯æˆ‘ç‚ºä»€éº¼è¦å’Œä½ åˆ†äº«é€™å€‹ç°¡å–®æ•…äº‹çš„åŸå› ã€‚â€œåœ¨å‡½å¼å…§å»¶é² importâ€ çš„åšæ³•ç•¶ç„¶æ²’æœ‰éŒ¯ï¼Œä½†æˆ‘å€‘æ›´æ‡‰è©²é—œæ³¨çš„æ˜¯ï¼š**æ•´å€‹å°ˆæ¡ˆå…§çš„æ¨¡çµ„ä¾è³´é—œä¿‚èˆ‡åˆ†å±¤æ˜¯å¦åˆç†ã€‚**

æœ€å¾Œï¼Œè®“æˆ‘å€‘å†å˜—è©¦å¾ å° R çš„æ•…äº‹è£¡å¼·è¡Œç¸½çµå‡ºå¹¾å€‹é“ç†å§ï¼š

- åˆç†çš„æ¨¡çµ„çµæ§‹èˆ‡åˆ†å±¤å¯ä»¥é™ä½å°ˆæ¡ˆçš„é–‹ç™¼ç¶­è­·æˆæœ¬
- åˆç†çš„æ¨¡çµ„çµæ§‹ä¸æ˜¯ä¸€æˆä¸è®Šçš„ï¼Œæ‡‰è©²éš¨è‘—å°ˆæ¡ˆç™¼å±•èª¿æ•´
- é‡åˆ°å•é¡Œæ™‚ï¼Œä¸è¦é¸**â€œç°¡å–®ä½†æœ‰ç¼ºé™·â€**çš„é‚£å€‹æ–¹æ¡ˆï¼Œè¦é¸**â€œéº»ç…©ä½†æ­£ç¢ºâ€**çš„é‚£å€‹
- æ•´å€‹å°ˆæ¡ˆå…§çš„æ¨¡çµ„é–“ä¾è³´é—œä¿‚æµå‘ï¼Œæ‡‰è©²æ˜¯å–®å‘çš„ï¼Œä¸èƒ½æœ‰ç’°å½¢ä¾è³´å­˜åœ¨

çœ‹å®Œæ–‡ç« çš„ä½ ï¼Œæœ‰æ²’æœ‰ä»€éº¼æƒ³åæ§½çš„ï¼Ÿè«‹ç•™è¨€æˆ–è€…åœ¨ [å°ˆæ¡ˆ Github Issues](https://github.com/piglei/one-python-craftsman) å‘Šè¨´æˆ‘å§ã€‚

[>>>ä¸‹ä¸€ç¯‡ã€10.åšä¸€å€‹ç²¾é€šè¦å‰‡çš„ç©å®¶ã€‘](10-a-good-player-know-the-rules.md)

[<<<ä¸Šä¸€ç¯‡ã€8.ä½¿ç”¨è£é£¾å™¨çš„æŠ€å·§ã€‘](8-tips-on-decorators.md)

## é™„éŒ„

- é¡Œåœ–ä¾†æº: Photo by Ricardo Gomez Angel on Unsplash
- æ›´å¤šç³»åˆ—æ–‡ç« åœ°å€ï¼šhttps://github.com/piglei/one-python-craftsman

ç³»åˆ—å…¶ä»–æ–‡ç« ï¼š

- [æ‰€æœ‰æ–‡ç« ç´¢å¼• [Github]](https://github.com/piglei/one-python-craftsman)
- [Python å·¥åŒ ï¼šç·¨å¯«æ¢ä»¶åˆ†æ”¯ç¨‹å¼ç¢¼çš„æŠ€å·§](https://www.zlovezl.cn/articles/python-else-block-secrets/)
- [Python å·¥åŒ ï¼šç•°å¸¸è™•ç†çš„ä¸‰å€‹å¥½ç¿’æ…£](https://www.zlovezl.cn/articles/three-rituals-of-exceptions-handling/)
- [Python å·¥åŒ ï¼šç·¨å¯«åœ°é“è¿´åœˆçš„å…©å€‹å»ºè­°](https://www.zlovezl.cn/articles/two-tips-on-loop-writing/)



