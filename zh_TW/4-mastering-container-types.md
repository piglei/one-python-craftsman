# Python å·¥åŒ ï¼šå®¹å™¨çš„é–€é“

## åºè¨€

> é€™æ˜¯ â€œPython å·¥åŒ â€ç³»åˆ—çš„ç¬¬ 4 ç¯‡æ–‡ç« ã€‚[[æª¢è¦–ç³»åˆ—æ‰€æœ‰æ–‡ç« ]](https://github.com/piglei/one-python-craftsman)

<div style="text-align: center; color: #999; margin: 14px 0 14px;font-size: 12px;">
<img src="https://www.zlovezl.cn/static//uploaded/2019/01/6002476959_cca2bf5424_b_thumb.jpg" width="100%" /><div>
åœ–ç‰‡ä¾†æº: <a href="https://www.flickr.com/photos/chiotsrun/6002476959/in/photolist-a9qgh4-W4eQ1j-7MrCfo-4ARLWp-dwCzHh-Tascu9-RNRbRf-foLHW5-22dkkHM-9ceFA8-aGGd3a-26X3sqQ-iuTwX9-q52ktA-osn2eb-29oujY-6mXd1c-8E92nc-mPbq55-9GuPU8-26Q1NZG-8UL8PL-pdyFsW-7V8ifD-VZavJ8-2cUdHbU-9WrgjZ-6g7M5K-VMLVrb-cXDd4-bygFJG-C76kP-nMQW54-7MoQqn-qA3fud-c92dBU-tAzTBm-7KqFXc-24VvcW1-djQX9e-5LzjkA-63U4kb-bt1EEY-jLRpKo-dQSWBH-aDbqXc-8KhfnE-2m5ZsF-6ciuiR-qwdbt">"The Humble Mason Jar" by Chiot's Run</a> - éå•†æ¥­æ€§ä½¿ç”¨ 2.0 é€šç”¨</div>
</div>

å®¹å™¨â€é€™å…©å€‹å­—å¾ˆå°‘è¢« Python æŠ€è¡“æ–‡ç« æèµ·ã€‚ä¸€çœ‹åˆ°â€œå®¹å™¨â€ï¼Œå¤§å®¶æƒ³åˆ°çš„å¤šæ˜¯é‚£é ­è—è‰²å°é¯¨é­šï¼š*Docker*ï¼Œä½†é€™ç¯‡æ–‡ç« å’Œå®ƒæ²’æœ‰ä»»ä½•é—œä¿‚ã€‚æœ¬æ–‡è£¡çš„å®¹å™¨ï¼Œæ˜¯ Python ä¸­çš„ä¸€å€‹æŠ½è±¡æ¦‚å¿µï¼Œæ˜¯å°**å°ˆé–€ç”¨ä¾†è£å…¶ä»–ç‰©ä»¶çš„è³‡æ–™å‹åˆ¥**çš„çµ±ç¨±ã€‚

åœ¨ Python ä¸­ï¼Œæœ‰å››é¡æœ€å¸¸è¦‹çš„å…§å»ºå®¹å™¨å‹åˆ¥ï¼š`åˆ—è¡¨ï¼ˆlistï¼‰`ã€`å…ƒçµ„ï¼ˆtupleï¼‰`ã€`å­—å…¸ï¼ˆdictï¼‰`ã€`é›†åˆï¼ˆsetï¼‰`ã€‚é€éå–®ç¨æˆ–æ˜¯çµ„åˆä½¿ç”¨å®ƒå€‘ï¼Œå¯ä»¥é«˜æ•ˆçš„å®Œæˆå¾ˆå¤šäº‹æƒ…ã€‚

Python èªè¨€è‡ªèº«çš„å…§éƒ¨å¯¦ç¾ç´°ç¯€ä¹Ÿèˆ‡é€™äº›å®¹å™¨å‹åˆ¥æ¯æ¯ç›¸é—œã€‚æ¯”å¦‚ Python çš„é¡ä¾‹é …å±¬æ€§ã€å…¨åŸŸæ€§è®Šæ•¸ `globals()` ç­‰å°±éƒ½æ˜¯é€éå­—å…¸å‹åˆ¥ä¾†å„²å­˜çš„ã€‚

åœ¨é€™ç¯‡æ–‡ç« è£¡ï¼Œæˆ‘é¦–å…ˆæœƒå¾å®¹å™¨å‹åˆ¥çš„å®šç¾©å‡ºç™¼ï¼Œå˜—è©¦ç¸½çµå‡ºä¸€äº›æ—¥å¸¸ç·¨ç¢¼çš„æœ€ä½³å¯¦è¸ã€‚ä¹‹å¾Œå†åœç¹å„å€‹å®¹å™¨å‹åˆ¥æä¾›çš„ç‰¹æ®Šæ©Ÿèƒ½ï¼Œåˆ†äº«ä¸€äº›ç¨‹å¼è¨­è¨ˆçš„å°æŠ€å·§ã€‚

### å…§å®¹ç›®éŒ„

* [åº•å±¤çœ‹å®¹å™¨](#åº•å±¤çœ‹å®¹å™¨)
    * [å¯«æ›´å¿«çš„ç¨‹å¼ç¢¼](#å¯«æ›´å¿«çš„ç¨‹å¼ç¢¼)
        * [1. é¿å…é »ç¹æ“´å……åˆ—è¡¨/å»ºç«‹æ–°åˆ—è¡¨](#1-é¿å…é »ç¹æ“´å……åˆ—è¡¨å»ºç«‹æ–°åˆ—è¡¨)
        * [2. åœ¨åˆ—è¡¨é ­éƒ¨æ“ä½œå¤šçš„å ´æ™¯ä½¿ç”¨ deque æ¨¡çµ„](#2-åœ¨åˆ—è¡¨é ­éƒ¨æ“ä½œå¤šçš„å ´æ™¯ä½¿ç”¨-deque-æ¨¡çµ„)
        * [3. ä½¿ç”¨é›†åˆ/å­—å…¸ä¾†åˆ¤æ–·æˆå“¡æ˜¯å¦å­˜åœ¨](#3-ä½¿ç”¨é›†åˆå­—å…¸ä¾†åˆ¤æ–·æˆå“¡æ˜¯å¦å­˜åœ¨)
* [é«˜å±¤çœ‹å®¹å™¨](#é«˜å±¤çœ‹å®¹å™¨)
    * [å¯«æ“´å……å¥—ä»¶æ€§æ›´å¥½çš„ç¨‹å¼ç¢¼](#å¯«æ“´å……å¥—ä»¶æ€§æ›´å¥½çš„ç¨‹å¼ç¢¼)
        * [é¢å‘å®¹å™¨ä»‹é¢ç¨‹å¼è¨­è¨ˆ](#é¢å‘å®¹å™¨ä»‹é¢ç¨‹å¼è¨­è¨ˆ)
* [å¸¸ç”¨æŠ€å·§](#å¸¸ç”¨æŠ€å·§)
    * [1. ä½¿ç”¨å…ƒçµ„æ”¹å–„åˆ†æ”¯ç¨‹å¼ç¢¼](#1-ä½¿ç”¨å…ƒçµ„æ”¹å–„åˆ†æ”¯ç¨‹å¼ç¢¼)
    * [2. åœ¨æ›´å¤šåœ°æ–¹ä½¿ç”¨å‹•æ…‹è§£åŒ…](#2-åœ¨æ›´å¤šåœ°æ–¹ä½¿ç”¨å‹•æ…‹è§£åŒ…)
    * [3. ä½¿ç”¨ next() å‡½å¼](#3-ä½¿ç”¨-next-å‡½å¼)
    * [4. ä½¿ç”¨æœ‰åºå­—å…¸ä¾†å»é‡](#4-ä½¿ç”¨æœ‰åºå­—å…¸ä¾†å»é‡)
* [å¸¸è¦‹èª¤å€](#å¸¸è¦‹èª¤å€)
    * [1. ç•¶å¿ƒé‚£äº›å·²ç¶“æ¯ç«­çš„è¿­ä»£å™¨](#1-ç•¶å¿ƒé‚£äº›å·²ç¶“æ¯ç«­çš„è¿­ä»£å™¨)
    * [2. åˆ¥åœ¨è¿´åœˆé«”å…§ä¿®æ”¹è¢«è¿­ä»£ç‰©ä»¶](#2-åˆ¥åœ¨è¿´åœˆé«”å…§ä¿®æ”¹è¢«è¿­ä»£ç‰©ä»¶)
* [ç¸½çµ](#ç¸½çµ)
* [ç³»åˆ—å…¶ä»–æ–‡ç« ](#ç³»åˆ—å…¶ä»–æ–‡ç« )
* [è¨»è§£](#è¨»è§£)


### ç•¶æˆ‘å€‘è«‡è«–å®¹å™¨æ™‚ï¼Œæˆ‘å€‘åœ¨è«‡äº›ä»€éº¼ï¼Ÿ

æˆ‘åœ¨å‰é¢çµ¦äº†â€œå®¹å™¨â€ä¸€å€‹ç°¡å–®çš„å®šç¾©ï¼š*å°ˆé–€ç”¨ä¾†è£å…¶ä»–ç‰©ä»¶çš„å°±æ˜¯å®¹å™¨*ã€‚ä½†é€™å€‹å®šç¾©å¤ªå¯¬æ³›äº†ï¼Œç„¡æ³•å°æˆ‘å€‘çš„æ—¥å¸¸ç¨‹å¼è¨­è¨ˆç”¢ç”Ÿä»€éº¼æŒ‡å°åƒ¹å€¼ã€‚è¦çœŸæ­£æŒæ¡ Python è£¡çš„å®¹å™¨ï¼Œéœ€è¦åˆ†åˆ¥å¾å…©å€‹å±¤é¢å…¥æ‰‹ï¼š

- **åº•å±¤å¯¦ç¾**ï¼šå…§å»ºå®¹å™¨å‹åˆ¥ä½¿ç”¨äº†ä»€éº¼è³‡æ–™çµæ§‹ï¼ŸæŸé …æ“ä½œå¦‚ä½•å·¥ä½œï¼Ÿ
- **é«˜å±¤æŠ½è±¡**ï¼šä»€éº¼æ±ºå®šäº†æŸå€‹ç‰©ä»¶æ˜¯ä¸æ˜¯å®¹å™¨ï¼Ÿå“ªäº›è¡Œç‚ºå®šç¾©äº†å®¹å™¨ï¼Ÿ

ä¸‹é¢ï¼Œè®“æˆ‘å€‘ä¸€èµ·ç«™åœ¨é€™å…©å€‹ä¸åŒçš„å±¤é¢ä¸Šï¼Œé‡æ–°èªè­˜å®¹å™¨ã€‚


## åº•å±¤çœ‹å®¹å™¨

Python æ˜¯ä¸€é–€é«˜éšç¨‹å¼èªè¨€ï¼Œ**å®ƒæ‰€æä¾›çš„å…§å»ºå®¹å™¨å‹åˆ¥ï¼Œéƒ½æ˜¯ç¶“éé«˜åº¦å°è£å’ŒæŠ½è±¡å¾Œçš„çµæœ**ã€‚å’Œâ€œé€£çµä¸²åˆ—â€ã€â€œç´…é»‘æ¨¹â€ã€â€œé›œæ¹Šè¡¨â€é€™äº›åå­—ç›¸æ¯”ï¼Œæ‰€æœ‰ Python å…§å»ºå‹åˆ¥çš„åå­—ï¼Œéƒ½åªæè¿°äº†é€™å€‹å‹åˆ¥çš„åŠŸèƒ½ç‰¹é»ï¼Œå…¶ä»–äººå®Œå…¨æ²’æ³•åªé€šéé€™äº›åå­—ç­è§£å®ƒå€‘çš„å“ªæ€•ä¸€ä¸é»å…§éƒ¨ç´°ç¯€ã€‚

é€™æ˜¯ Python ç¨‹å¼èªè¨€çš„å„ªå‹¢ä¹‹ä¸€ã€‚ç›¸æ¯” C èªè¨€é€™é¡æ›´æ¥è¿‘è¨ˆç®—æ©Ÿåº•å±¤çš„ç¨‹å¼èªè¨€ï¼ŒPython é‡æ–°è¨­è¨ˆä¸¦å¯¦ç¾äº†å°ç¨‹å¼è¨­è¨ˆè€…æ›´å‹å¥½çš„å…§å»ºå®¹å™¨å‹åˆ¥ï¼Œé®è”½æ‰äº†è¨˜æ†¶é«”ç®¡ç†ç­‰é¡å¤–å·¥ä½œã€‚ç‚ºæˆ‘å€‘æä¾›äº†æ›´å¥½çš„é–‹ç™¼é«”é©—ã€‚

ä½†å¦‚æœé€™æ˜¯ Python èªè¨€çš„å„ªå‹¢çš„è©±ï¼Œç‚ºä»€éº¼æˆ‘å€‘é‚„è¦è²»å‹å»äº†è§£å®¹å™¨å‹åˆ¥çš„å¯¦ç¾ç´°ç¯€å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼š**é—œæ³¨ç´°ç¯€å¯ä»¥å¹«åŠ©æˆ‘å€‘ç·¨å¯«å‡ºæ›´å¿«çš„ç¨‹å¼ç¢¼ã€‚**

### å¯«æ›´å¿«çš„ç¨‹å¼ç¢¼

#### 1. é¿å…é »ç¹æ“´å……åˆ—è¡¨/å»ºç«‹æ–°åˆ—è¡¨

æ‰€æœ‰çš„å…§å»ºå®¹å™¨å‹åˆ¥éƒ½ä¸é™åˆ¶å®¹é‡ã€‚å¦‚æœä½ é¡˜æ„ï¼Œä½ å¯ä»¥æŠŠéå¢çš„æ•¸å­—ä¸æ–·å¡é€²ä¸€å€‹ç©ºåˆ—è¡¨ï¼Œæœ€çµ‚æ’çˆ†æ•´è‡ºæ©Ÿå™¨çš„è¨˜æ†¶é«”ã€‚

åœ¨ Python èªè¨€çš„å¯¦ç¾ç´°ç¯€è£¡ï¼Œåˆ—è¡¨çš„è¨˜æ†¶é«”æ˜¯æŒ‰éœ€åˆ†é…çš„[[æ³¨1]](#annot1)ï¼Œç•¶æŸå€‹åˆ—è¡¨ç•¶å‰æ“æœ‰çš„è¨˜æ†¶é«”ä¸å¤ æ™‚ï¼Œä¾¿æœƒè§¸ç™¼è¨˜æ†¶é«”æ“´å®¹é‚è¼¯ã€‚è€Œåˆ†é…è¨˜æ†¶é«”æ˜¯ä¸€é …æ˜‚è²´çš„æ“ä½œã€‚é›–ç„¶å¤§éƒ¨åˆ†æƒ…æ³ä¸‹ï¼Œå®ƒä¸æœƒå°ä½ çš„ç¨‹å¼æ•ˆèƒ½ç”¢ç”Ÿä»€éº¼åš´é‡çš„å½±éŸ¿ã€‚ä½†æ˜¯ç•¶ä½ è™•ç†çš„è³‡æ–™é‡ç‰¹åˆ¥å¤§æ™‚ï¼Œå¾ˆå®¹æ˜“å› ç‚ºè¨˜æ†¶é«”åˆ†é…æ‹–ç´¯æ•´å€‹ç¨‹å¼çš„æ•ˆèƒ½ã€‚

é‚„å¥½ï¼ŒPython æ—©å°±æ„è­˜åˆ°äº†é€™å€‹å•é¡Œï¼Œä¸¦æä¾›äº†å®˜æ–¹çš„å•é¡Œè§£æ±ºæŒ‡å¼•ï¼Œé‚£å°±æ˜¯ï¼š**â€œè®Šæ‡¶â€**ã€‚

å¦‚ä½•è§£é‡‹â€œè®Šæ‡¶â€ï¼Ÿ`range()` å‡½å¼çš„é€²åŒ–æ˜¯ä¸€å€‹éå¸¸å¥½çš„ä¾‹å­ã€‚

åœ¨ Python 2 ä¸­ï¼Œå¦‚æœä½ å‘¼å« `range(100000000)`ï¼Œéœ€è¦ç­‰å¾…å¥½å¹¾ç§’æ‰èƒ½æ‹¿åˆ°çµæœï¼Œå› ç‚ºå®ƒéœ€è¦è¿”å›ä¸€å€‹å·¨å¤§çš„åˆ—è¡¨ï¼ŒèŠ±è²»äº†éå¸¸å¤šçš„æ™‚é–“åœ¨è¨˜æ†¶é«”åˆ†é…èˆ‡è¨ˆç®—ä¸Šã€‚ä½†åœ¨ Python 3 ä¸­ï¼ŒåŒæ¨£çš„å‘¼å«é¦¬ä¸Šå°±èƒ½æ‹¿åˆ°çµæœã€‚å› ç‚ºå‡½å¼è¿”å›çš„ä¸å†æ˜¯åˆ—è¡¨ï¼Œè€Œæ˜¯ä¸€å€‹å‹åˆ¥ç‚º `range` çš„æ‡¶æƒ°ç‰©ä»¶ï¼Œåªæœ‰åœ¨ä½ è¿­ä»£å®ƒã€æˆ–æ˜¯å°å®ƒé€²è¡Œåˆ‡ç‰‡æ™‚ï¼Œå®ƒæ‰æœƒè¿”å›çœŸæ­£çš„æ•¸å­—çµ¦ä½ ã€‚

**æ‰€ä»¥èªªï¼Œç‚ºäº†æé«˜æ•ˆèƒ½ï¼Œå…§å»ºå‡½å¼ `range` â€œè®Šæ‡¶â€äº†ã€‚** è€Œç‚ºäº†é¿å…éæ–¼é »ç¹çš„è¨˜æ†¶é«”åˆ†é…ï¼Œåœ¨æ—¥å¸¸ç·¨ç¢¼ä¸­ï¼Œæˆ‘å€‘çš„å‡½å¼åŒæ¨£ä¹Ÿéœ€è¦è®Šæ‡¶ï¼Œé€™åŒ…æ‹¬ï¼š

- æ›´å¤šçš„ä½¿ç”¨ `yield` é—œéµå­—ï¼Œè¿”å›ç”Ÿæˆå™¨ç‰©ä»¶
- å„˜é‡ä½¿ç”¨ç”Ÿæˆå™¨è¡¨ç¤ºå¼æ›¿ä»£åˆ—è¡¨æ¨å°è¡¨ç¤ºå¼
    - ç”Ÿæˆå™¨è¡¨ç¤ºå¼ï¼š`(i for i in range(100))` ğŸ‘
    - åˆ—è¡¨æ¨å°è¡¨ç¤ºå¼ï¼š`[i for i in range(100)]`
- å„˜é‡ä½¿ç”¨æ¨¡çµ„æä¾›çš„æ‡¶æƒ°ç‰©ä»¶ï¼š
    - ä½¿ç”¨ `re.finditer` æ›¿ä»£ `re.findall`
    - ç›´æ¥ä½¿ç”¨å¯è¿­ä»£çš„æª”æ¡ˆç‰©ä»¶ï¼š `for line in fp`ï¼Œè€Œä¸æ˜¯ `for line in fp.readlines()`

#### 2. åœ¨åˆ—è¡¨é ­éƒ¨æ“ä½œå¤šçš„å ´æ™¯ä½¿ç”¨ deque æ¨¡çµ„

åˆ—è¡¨æ˜¯åŸºæ–¼é™£åˆ—çµæ§‹ï¼ˆArrayï¼‰å¯¦ç¾çš„ï¼Œç•¶ä½ åœ¨åˆ—è¡¨çš„é ­éƒ¨æ’å…¥æ–°æˆå“¡ï¼ˆ`list.insert(0, item)`ï¼‰æ™‚ï¼Œå®ƒå¾Œé¢çš„æ‰€æœ‰å…¶ä»–æˆå“¡éƒ½éœ€è¦è¢«ç§»å‹•ï¼Œæ“ä½œçš„æ™‚é–“è¤‡é›œåº¦æ˜¯ `O(n)`ã€‚é€™å°è‡´åœ¨åˆ—è¡¨çš„é ­éƒ¨æ’å…¥æˆå“¡é æ¯”åœ¨å°¾éƒ¨è¿½åŠ ï¼ˆ`list.append(item)` æ™‚é–“è¤‡é›œåº¦ç‚º `O(1)`ï¼‰è¦æ…¢ã€‚

å¦‚æœä½ çš„ç¨‹å¼ç¢¼éœ€è¦åŸ·è¡Œå¾ˆå¤šæ¬¡é€™é¡æ“ä½œï¼Œè«‹è€ƒæ…®ä½¿ç”¨ [collections.deque](https://docs.python.org/3.7/library/collections.html#collections.deque) å‹åˆ¥ä¾†æ›¿ä»£åˆ—è¡¨ã€‚å› ç‚º deque æ˜¯åŸºæ–¼é›™ç«¯ä½‡åˆ—å¯¦ç¾çš„ï¼Œç„¡è«–æ˜¯åœ¨é ­éƒ¨é‚„æ˜¯å°¾éƒ¨è¿½åŠ å…ƒç´ ï¼Œæ™‚é–“è¤‡é›œåº¦éƒ½æ˜¯ `O(1)`ã€‚

#### 3. ä½¿ç”¨é›†åˆ/å­—å…¸ä¾†åˆ¤æ–·æˆå“¡æ˜¯å¦å­˜åœ¨

ç•¶ä½ éœ€è¦åˆ¤æ–·æˆå“¡æ˜¯å¦å­˜åœ¨æ–¼æŸå€‹å®¹å™¨æ™‚ï¼Œç”¨é›†åˆæ¯”åˆ—è¡¨æ›´åˆé©ã€‚å› ç‚º `item in [...]` æ“ä½œçš„æ™‚é–“è¤‡é›œåº¦æ˜¯ `O(n)`ï¼Œè€Œ `item in {...}` çš„æ™‚é–“è¤‡é›œåº¦æ˜¯ `O(1)`ã€‚é€™æ˜¯å› ç‚ºå­—å…¸èˆ‡é›†åˆéƒ½æ˜¯åŸºæ–¼é›œæ¹Šè¡¨ï¼ˆHash Tableï¼‰è³‡æ–™çµæ§‹å¯¦ç¾çš„ã€‚

```python
# é€™å€‹ä¾‹å­ä¸æ˜¯ç‰¹åˆ¥æ°ç•¶ï¼Œå› ç‚ºç•¶ç›®æ¨™é›†åˆç‰¹åˆ¥å°æ™‚ï¼Œä½¿ç”¨é›†åˆé‚„æ˜¯åˆ—è¡¨å°æ•ˆç‡çš„å½±éŸ¿å¾®ä¹å…¶å¾®
# ä½†é€™ä¸æ˜¯é‡é» :)
VALID_NAMES = ["piglei", "raymond", "bojack", "caroline"]

# è½‰æ›ç‚ºé›†åˆå‹åˆ¥å°ˆé–€ç”¨æ–¼æˆå“¡åˆ¤æ–·
VALID_NAMES_SET = set(VALID_NAMES)


def validate_name(name):
    if name not in VALID_NAMES_SET:
        # æ­¤è™•ä½¿ç”¨äº† Python 3.6 æ–°å¢çš„ f-strings ç‰¹æ€§
        raise ValueError(f"{name} is not a valid name!")
```

> Hint: å¼·çƒˆå»ºè­°é–±è®€ [TimeComplexity - Python Wiki](https://wiki.python.org/moin/TimeComplexity)ï¼Œç­è§£æ›´å¤šé—œæ–¼å¸¸è¦‹å®¹å™¨å‹åˆ¥çš„æ™‚é–“è¤‡é›œåº¦ç›¸é—œå…§å®¹ã€‚
> 
> å¦‚æœä½ å°å­—å…¸çš„å¯¦ç¾ç´°ç¯€æ„Ÿèˆˆè¶£ï¼Œä¹Ÿå¼·çƒˆå»ºè­°è§€çœ‹ Raymond Hettinger çš„æ¼”è¬› [Modern Dictionaries(YouTube)](https://www.youtube.com/watch?v=p33CVV29OG8&t=1403s)

## é«˜å±¤çœ‹å®¹å™¨

Python æ˜¯ä¸€é–€â€œ[é´¨å­å‹åˆ¥](https://en.wikipedia.org/wiki/Duck_typing)â€èªè¨€ï¼š*â€œç•¶çœ‹åˆ°ä¸€éš»é³¥èµ°èµ·ä¾†åƒé´¨å­ã€æ¸¸æ³³èµ·ä¾†åƒé´¨å­ã€å«èµ·ä¾†ä¹Ÿåƒé´¨å­ï¼Œé‚£éº¼é€™éš»é³¥å°±å¯ä»¥è¢«ç¨±ç‚ºé´¨å­ã€‚â€* æ‰€ä»¥ï¼Œç•¶æˆ‘å€‘èªªæŸå€‹ç‰©ä»¶æ˜¯ä»€éº¼å‹åˆ¥æ™‚ï¼Œåœ¨æ ¹æœ¬ä¸Šå…¶å¯¦æŒ‡çš„æ˜¯ï¼š **é€™å€‹ç‰©ä»¶æ»¿è¶³äº†è©²å‹åˆ¥çš„ç‰¹å®šä»‹é¢è¦ç¯„ï¼Œå¯ä»¥è¢«ç•¶æˆé€™å€‹å‹åˆ¥ä¾†ä½¿ç”¨ã€‚** è€Œå°æ–¼æ‰€æœ‰å…§å»ºå®¹å™¨å‹åˆ¥ä¾†èªªï¼ŒåŒæ¨£å¦‚æ­¤ã€‚

é–‹å•Ÿä½æ–¼ [collections](https://docs.python.org/3.7/library/collections.html) æ¨¡çµ„ä¸‹çš„ [abc](https://docs.python.org/3/library/collections.abc.html)*ï¼ˆâ€œæŠ½è±¡é¡ Abstract Base Classesâ€çš„é¦–å­—æ¯ç¸®å¯«ï¼‰* å­æ¨¡çµ„ï¼Œå¯ä»¥æ‰¾åˆ°æ‰€æœ‰èˆ‡å®¹å™¨ç›¸é—œçš„ä»‹é¢ï¼ˆæŠ½è±¡é¡ï¼‰[[æ³¨2]](#annot2)å®šç¾©ã€‚è®“æˆ‘å€‘åˆ†åˆ¥çœ‹çœ‹é‚£äº›å…§å»ºå®¹å™¨å‹åˆ¥éƒ½æ»¿è¶³äº†ä»€éº¼ä»‹é¢ï¼š

- **åˆ—è¡¨ï¼ˆlistï¼‰**ï¼šæ»¿è¶³ `Iterable`ã€`Sequence`ã€`MutableSequence` ç­‰ä»‹é¢
- **å…ƒçµ„ï¼ˆtupleï¼‰**ï¼šæ»¿è¶³ `Iterable`ã€`Sequence`
- **å­—å…¸ï¼ˆdictï¼‰**ï¼šæ»¿è¶³ `Iterable`ã€`Mapping`ã€`MutableMapping` [[æ³¨3]](#annot3)
- **é›†åˆï¼ˆsetï¼‰**ï¼šæ»¿è¶³ `Iterable`ã€`Set`ã€`MutableSet` [[æ³¨4]](#annot4)

æ¯å€‹å…§å»ºå®¹å™¨å‹åˆ¥ï¼Œå…¶å¯¦å°±æ˜¯æ»¿è¶³äº†å¤šå€‹ä»‹é¢å®šç¾©çš„çµ„åˆå¯¦é«”ã€‚æ¯”å¦‚æ‰€æœ‰çš„å®¹å™¨å‹åˆ¥éƒ½æ»¿è¶³ `â€œå¯è¢«è¿­ä»£çš„â€ï¼ˆIterable`ï¼‰ é€™å€‹ä»‹é¢ï¼Œé€™æ„å‘³è‘—å®ƒå€‘éƒ½æ˜¯â€œå¯è¢«è¿­ä»£â€çš„ã€‚ä½†æ˜¯åéä¾†ï¼Œä¸æ˜¯æ‰€æœ‰â€œå¯è¢«è¿­ä»£â€çš„ç‰©ä»¶éƒ½æ˜¯å®¹å™¨ã€‚å°±åƒå­—ä¸²é›–ç„¶å¯ä»¥è¢«è¿­ä»£ï¼Œä½†æˆ‘å€‘é€šå¸¸ä¸æœƒæŠŠå®ƒç•¶åšâ€œå®¹å™¨â€ä¾†çœ‹å¾…ã€‚

ç­è§£é€™å€‹äº‹å¯¦å¾Œï¼Œæˆ‘å€‘å°‡**åœ¨ Python è£¡é‡æ–°èªè­˜**é¢å‘ç‰©ä»¶ç¨‹å¼è¨­è¨ˆä¸­æœ€é‡è¦çš„åŸå‰‡ä¹‹ä¸€ï¼š**é¢å‘ä»‹é¢è€Œéå…·é«”å¯¦ç¾ä¾†ç¨‹å¼è¨­è¨ˆã€‚**

è®“æˆ‘å€‘é€éä¸€å€‹ä¾‹å­ï¼Œçœ‹çœ‹å¦‚ä½•ç†è§£ Python è£¡çš„â€œé¢å‘ä»‹é¢ç¨‹å¼è¨­è¨ˆâ€ã€‚

### å¯«æ“´å……å¥—ä»¶æ€§æ›´å¥½çš„ç¨‹å¼ç¢¼

æŸæ—¥ï¼Œæˆ‘å€‘æ¥åˆ°ä¸€å€‹éœ€æ±‚ï¼š*æœ‰ä¸€å€‹åˆ—è¡¨ï¼Œè£¡é¢è£è‘—å¾ˆå¤šä½¿ç”¨è€…è©•è«–ï¼Œç‚ºäº†åœ¨é é¢æ­£å¸¸å±•ç¤ºï¼Œéœ€è¦å°‡æ‰€æœ‰è¶…éä¸€å®šé•·åº¦çš„è©•è«–ç”¨çœç•¥è™Ÿæ›¿ä»£*ã€‚

é€™å€‹éœ€æ±‚å¾ˆå¥½åšï¼Œå¾ˆå¿«æˆ‘å€‘å°±å¯«å‡ºäº†ç¬¬ä¸€å€‹ç‰ˆæœ¬çš„ç¨‹å¼ç¢¼ï¼š

```python
# æ³¨ï¼šç‚ºäº†åŠ å¼·ç¤ºä¾‹ç¨‹å¼ç¢¼çš„èªªæ˜æ€§ï¼Œæœ¬æ–‡ä¸­çš„éƒ¨åˆ†ç¨‹å¼ç¢¼ç‰‡æ®µä½¿ç”¨äº†Python 3.5
# ç‰ˆæœ¬æ–°å¢çš„ Type Hinting ç‰¹æ€§

def add_ellipsis(comments: typing.List[str], max_length: int = 12):
    """å¦‚æœè©•è«–åˆ—è¡¨è£¡çš„å…§å®¹è¶…é max_lengthï¼Œå‰©ä¸‹çš„å­—å…ƒç”¨çœç•¥è™Ÿä»£æ›¿
    """
    index = 0
    for comment in comments:
        comment = comment.strip()
        if len(comment) > max_length:
            comments[index] = comment[:max_length] + '...'
        index += 1
    return comments


comments = [
    "Implementation note",
    "Changed",
    "ABC for generator",
]
print("\n".join(add_ellipsis(comments)))
# OUTPUT:
# Implementati...
# Changed
# ABC for gene...
```

ä¸Šé¢çš„ç¨‹å¼ç¢¼è£¡ï¼Œ`add_ellipsis` å‡½å¼æ¥æ”¶ä¸€å€‹åˆ—è¡¨ä½œç‚ºå¼•æ•¸ï¼Œç„¶å¾Œéæ­·å®ƒï¼Œæ›¿æ›æ‰éœ€è¦ä¿®æ”¹çš„æˆå“¡ã€‚é€™ä¸€åˆ‡çœ‹ä¸Šå»å¾ˆåˆç†ï¼Œå› ç‚ºæˆ‘å€‘æ¥åˆ°çš„æœ€åŸå§‹éœ€æ±‚å°±æ˜¯ï¼šâ€œæœ‰ä¸€å€‹ **åˆ—è¡¨**ï¼Œè£¡é¢...â€ã€‚**ä½†å¦‚æœæœ‰ä¸€å¤©ï¼Œæˆ‘å€‘æ‹¿åˆ°çš„è©•è«–ä¸å†æ˜¯è¢«ç¹¼çºŒè£åœ¨åˆ—è¡¨è£¡ï¼Œè€Œæ˜¯åœ¨ä¸å¯è®Šçš„å…ƒçµ„è£¡å‘¢ï¼Ÿ**

é‚£æ¨£çš„è©±ï¼Œç¾æœ‰çš„å‡½å¼è¨­è¨ˆå°±æœƒé€¼è¿«æˆ‘å€‘å¯«å‡º `add_ellipsis(list(comments))` é€™ç¨®å³æ…¢åˆé›£çœ‹çš„ç¨‹å¼ç¢¼äº†ã€‚ğŸ˜¨

#### é¢å‘å®¹å™¨ä»‹é¢ç¨‹å¼è¨­è¨ˆ

æˆ‘å€‘éœ€è¦æ”¹é€²å‡½å¼ä¾†é¿å…é€™å€‹å•é¡Œã€‚å› ç‚º `add_ellipsis` å‡½å¼å¼·ä¾è³´äº†åˆ—è¡¨å‹åˆ¥ï¼Œæ‰€ä»¥ç•¶å¼•æ•¸å‹åˆ¥è®Šç‚ºå…ƒçµ„æ™‚ï¼Œç¾åœ¨çš„å‡½å¼å°±ä¸å†é©ç”¨äº†*ï¼ˆåŸå› ï¼šçµ¦ `comments[index]` è³¦å€¼çš„åœ°æ–¹æœƒä¸Ÿæ“² `TypeError` ç•°å¸¸ï¼‰ã€‚* å¦‚ä½•æ”¹å–„é€™éƒ¨åˆ†çš„è¨­è¨ˆï¼Ÿç¥•è¨£å°±æ˜¯ï¼š**è®“å‡½å¼ä¾è³´â€œå¯è¿­ä»£ç‰©ä»¶â€é€™å€‹æŠ½è±¡æ¦‚å¿µï¼Œè€Œéå¯¦é«”åˆ—è¡¨å‹åˆ¥ã€‚**

ä½¿ç”¨ç”Ÿæˆå™¨ç‰¹æ€§ï¼Œå‡½å¼å¯ä»¥è¢«æ”¹æˆé€™æ¨£ï¼š

```python
def add_ellipsis_gen(comments: typing.Iterable[str], max_length: int = 12):
    """å¦‚æœå¯è¿­ä»£è©•è«–è£¡çš„å…§å®¹è¶…é max_lengthï¼Œå‰©ä¸‹çš„å­—å…ƒç”¨çœç•¥è™Ÿä»£æ›¿
    """
    for comment in comments:
        comment = comment.strip()
        if len(comment) > max_length:
            yield comment[:max_length] + '...'
        else:
            yield comment


print("\n".join(add_ellipsis_gen(comments)))
```

åœ¨æ–°å‡½å¼è£¡ï¼Œæˆ‘å€‘å°‡ä¾è³´çš„å¼•æ•¸å‹åˆ¥å¾åˆ—è¡¨æ”¹æˆäº†å¯è¿­ä»£çš„æŠ½è±¡é¡ã€‚é€™æ¨£åšæœ‰å¾ˆå¤šå¥½è™•ï¼Œä¸€å€‹æœ€æ˜é¡¯çš„å°±æ˜¯ï¼šç„¡è«–è©•è«–æ˜¯ä¾†è‡ªåˆ—è¡¨ã€å…ƒçµ„æˆ–æ˜¯æŸå€‹æª”æ¡ˆï¼Œæ–°å‡½å¼éƒ½å¯ä»¥è¼•é¬†æ»¿è¶³ï¼š

```python
# è™•ç†æ”¾åœ¨å…ƒçµ„è£¡çš„è©•è«–
comments = ("Implementation note", "Changed", "ABC for generator")
print("\n".join(add_ellipsis_gen(comments)))

# è™•ç†æ”¾åœ¨æª”æ¡ˆè£¡çš„è©•è«–
with open("comments") as fp:
    for comment in add_ellipsis_gen(fp):
        print(comment)
```

å°‡ä¾è³´ç”±æŸå€‹å…·é«”çš„å®¹å™¨å‹åˆ¥æ”¹ç‚ºæŠ½è±¡ä»‹é¢å¾Œï¼Œå‡½å¼çš„é©ç”¨é¢è®Šå¾—æ›´å»£äº†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ–°å‡½å¼åœ¨åŸ·è¡Œæ•ˆç‡ç­‰æ–¹é¢ä¹Ÿéƒ½æ›´æœ‰å„ªå‹¢ã€‚ç¾åœ¨è®“æˆ‘å€‘å†å›åˆ°ä¹‹å‰çš„å•é¡Œã€‚**å¾é«˜å±¤ä¾†çœ‹ï¼Œä»€éº¼å®šç¾©äº†å®¹å™¨ï¼Ÿ**

ç­”æ¡ˆæ˜¯ï¼š **å„å€‹å®¹å™¨å‹åˆ¥å¯¦ç¾çš„ä»‹é¢å”è­°å®šç¾©äº†å®¹å™¨ã€‚** ä¸åŒçš„å®¹å™¨å‹åˆ¥åœ¨æˆ‘å€‘çš„çœ¼è£¡ï¼Œæ‡‰è©²æ˜¯ `æ˜¯å¦å¯ä»¥è¿­ä»£`ã€`æ˜¯å¦å¯ä»¥ä¿®æ”¹`ã€`æœ‰æ²’æœ‰é•·åº¦` ç­‰å„ç¨®ç‰¹æ€§çš„çµ„åˆã€‚æˆ‘å€‘éœ€è¦åœ¨ç·¨å¯«ç›¸é—œç¨‹å¼ç¢¼æ™‚ï¼Œ**æ›´å¤šçš„é—œæ³¨å®¹å™¨çš„æŠ½è±¡å±¬æ€§ï¼Œè€Œéå®¹å™¨å‹åˆ¥æœ¬èº«**ï¼Œé€™æ¨£å¯ä»¥å¹«åŠ©æˆ‘å€‘å¯«å‡ºæ›´å„ªé›…ã€æ“´å……å¥—ä»¶æ€§æ›´å¥½çš„ç¨‹å¼ç¢¼ã€‚

> Hintï¼šåœ¨ [itertools](https://docs.python.org/3/library/itertools.html) èˆ‡ [more-itertools](https://pypi.org/project/more-itertools/) æ¨¡çµ„è£¡å¯ä»¥æ‰¾åˆ°æ›´å¤šé—œæ–¼è™•ç†å¯è¿­ä»£ç‰©ä»¶çš„å¯¶è—ã€‚

## å¸¸ç”¨æŠ€å·§

### 1. ä½¿ç”¨å…ƒçµ„æ”¹å–„åˆ†æ”¯ç¨‹å¼ç¢¼

æœ‰æ™‚ï¼Œæˆ‘å€‘çš„ç¨‹å¼ç¢¼è£¡æœƒå‡ºç¾è¶…éä¸‰å€‹åˆ†æ”¯çš„ `if/else` ã€‚å°±åƒä¸‹é¢é€™æ¨£ï¼š

```python
import time


def from_now(ts):
    """æ¥æ”¶ä¸€å€‹éå»çš„æ™‚é–“æˆ³ï¼Œè¿”å›è·é›¢ç•¶å‰æ™‚é–“çš„ç›¸å°æ™‚é–“æ–‡å­—æè¿°
    """
    now = time.time()
    seconds_delta = int(now - ts)
    if seconds_delta < 1:
        return "less than 1 second ago"
    elif seconds_delta < 60:
        return "{} seconds ago".format(seconds_delta)
    elif seconds_delta < 3600:
        return "{} minutes ago".format(seconds_delta // 60)
    elif seconds_delta < 3600 * 24:
        return "{} hours ago".format(seconds_delta // 3600)
    else:
        return "{} days ago".format(seconds_delta // (3600 * 24))


now = time.time()
print(from_now(now))
print(from_now(now - 24))
print(from_now(now - 600))
print(from_now(now - 7500))
print(from_now(now - 87500))
# OUTPUT:
# less than 1 second ago
# 24 seconds ago
# 10 minutes ago
# 2 hours ago
# 1 days ago
```

ä¸Šé¢é€™å€‹å‡½å¼æŒ‘ä¸å‡ºå¤ªå¤šæ¯›ç—…ï¼Œå¾ˆå¤šå¾ˆå¤šäººéƒ½æœƒå¯«å‡ºé¡ä¼¼çš„ç¨‹å¼ç¢¼ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ä»”ç´°è§€å¯Ÿå®ƒï¼Œå¯ä»¥åœ¨åˆ†æ”¯ç¨‹å¼ç¢¼éƒ¨åˆ†æ‰¾åˆ°ä¸€äº›æ˜é¡¯çš„â€œ**é‚Šç•Œ**â€ã€‚ æ¯”å¦‚ï¼Œç•¶å‡½å¼åˆ¤æ–·æŸå€‹æ™‚é–“æ˜¯å¦æ‡‰è©²ç”¨â€œç§’æ•¸â€å±•ç¤ºæ™‚ï¼Œç”¨åˆ°äº† `60`ã€‚è€Œåˆ¤æ–·æ˜¯å¦æ‡‰è©²ç”¨åˆ†é˜æ™‚ï¼Œç”¨åˆ°äº† `3600`ã€‚

**å¾é‚Šç•Œæç…‰è¦å¾‹æ˜¯æœ€ä½³åŒ–é€™æ®µç¨‹å¼ç¢¼çš„é—œéµã€‚** å¦‚æœæˆ‘å€‘å°‡æ‰€æœ‰çš„é€™äº›é‚Šç•Œæ”¾åœ¨ä¸€å€‹æœ‰åºå…ƒçµ„ä¸­ï¼Œç„¶å¾Œé…åˆäºŒåˆ†æŸ¥è©¢æ¨¡çµ„ [bisect](https://docs.python.org/3.7/library/bisect.html)ã€‚æ•´å€‹å‡½å¼çš„æ§åˆ¶æµå°±èƒ½è¢«å¤§å¤§ç°¡åŒ–ï¼š

```python
import bisect


# BREAKPOINTS å¿…é ˆæ˜¯å·²ç¶“æ’å¥½åºçš„ï¼Œä¸ç„¶ç„¡æ³•é€²è¡ŒäºŒåˆ†æŸ¥è©¢
BREAKPOINTS = (1, 60, 3600, 3600 * 24)
TMPLS = (
    # unit, template
    (1, "less than 1 second ago"),
    (1, "{units} seconds ago"),
    (60, "{units} minutes ago"),
    (3600, "{units} hours ago"),
    (3600 * 24, "{units} days ago"),
)


def from_now(ts):
    """æ¥æ”¶ä¸€å€‹éå»çš„æ™‚é–“æˆ³ï¼Œè¿”å›è·é›¢ç•¶å‰æ™‚é–“çš„ç›¸å°æ™‚é–“æ–‡å­—æè¿°
    """
    seconds_delta = int(time.time() - ts)
    unit, tmpl = TMPLS[bisect.bisect(BREAKPOINTS, seconds_delta)]
    return tmpl.format(units=seconds_delta // unit)
```

é™¤äº†ç”¨å…ƒçµ„å¯ä»¥æœ€ä½³åŒ–éå¤šçš„ `if/else` åˆ†æ”¯å¤–ï¼Œæœ‰äº›æƒ…æ³ä¸‹å­—å…¸ä¹Ÿèƒ½è¢«ç”¨ä¾†åšåŒæ¨£çš„äº‹æƒ…ã€‚é—œéµåœ¨æ–¼å¾ç¾æœ‰ç¨‹å¼ç¢¼æ‰¾åˆ°é‡è¤‡çš„é‚è¼¯èˆ‡è¦å¾‹ï¼Œä¸¦å¤šå¤šå˜—è©¦ã€‚

### 2. åœ¨æ›´å¤šåœ°æ–¹ä½¿ç”¨å‹•æ…‹è§£åŒ…

å‹•æ…‹è§£åŒ…æ“ä½œæ˜¯æŒ‡ä½¿ç”¨ `*` æˆ– `**` é‹ç®—å­å°‡å¯è¿­ä»£ç‰©ä»¶â€œè§£é–‹â€çš„è¡Œç‚ºï¼Œåœ¨ Python 2 æ™‚ä»£ï¼Œé€™å€‹æ“ä½œåªèƒ½è¢«ç”¨åœ¨å‡½å¼å¼•æ•¸éƒ¨åˆ†ï¼Œä¸¦ä¸”å°å‡ºç¾é †åºå’Œæ•¸é‡éƒ½æœ‰éå¸¸åš´æ ¼çš„è¦æ±‚ï¼Œä½¿ç”¨å ´æ™¯éå¸¸å–®ä¸€ã€‚

```python
def calc(a, b, multiplier=1):
    return (a + b) * multiplier


# Python2 ä¸­åªæ”¯æ´åœ¨å‡½å¼å¼•æ•¸éƒ¨åˆ†é€²è¡Œå‹•æ…‹è§£åŒ…
print calc(*[1, 2], **{"multiplier": 10})
# OUTPUT: 30
```

ä¸éï¼ŒPython 3 å°¤å…¶æ˜¯ 3.5 ç‰ˆæœ¬å¾Œï¼Œ`*` å’Œ `**` çš„ä½¿ç”¨å ´æ™¯è¢«å¤§å¤§æ“´å……äº†ã€‚èˆ‰å€‹ä¾‹å­ï¼Œåœ¨ Python 2 ä¸­ï¼Œå¦‚æœæˆ‘å€‘éœ€è¦åˆä½µå…©å€‹å­—å…¸ï¼Œéœ€è¦é€™éº¼åšï¼š

```python
def merge_dict(d1, d2):
    # å› ç‚ºå­—å…¸æ˜¯å¯è¢«ä¿®æ”¹çš„ç‰©ä»¶ï¼Œç‚ºäº†é¿å…ä¿®æ”¹åŸç‰©ä»¶ï¼Œæ­¤è™•éœ€è¦è¤‡è£½ä¸€å€‹ d1 çš„æ·ºè¤‡è£½
    result = d1.copy()
    result.update(d2)
    return result
    
user = merge_dict({"name": "piglei"}, {"movies": ["Fight Club"]})
```

ä½†æ˜¯åœ¨ Python 3.5 ä»¥å¾Œçš„ç‰ˆæœ¬ï¼Œä½ å¯ä»¥ç›´æ¥ç”¨ `**` é‹ç®—å­ä¾†å¿«é€Ÿå®Œæˆå­—å…¸çš„åˆä½µæ“ä½œï¼š

```
user = {**{"name": "piglei"}, **{"movies": ["Fight Club"]}}
```

é™¤æ­¤ä¹‹å¤–ï¼Œä½ é‚„å¯ä»¥åœ¨æ™®é€šè³¦å€¼èªå¥ä¸­ä½¿ç”¨ `*` é‹ç®—å­ä¾†å‹•æ…‹çš„è§£åŒ…å¯è¿­ä»£ç‰©ä»¶ã€‚å¦‚æœä½ æƒ³è©³ç´°ç­è§£ç›¸é—œå…§å®¹ï¼Œå¯ä»¥é–±è®€ä¸‹é¢æ¨è–¦çš„ PEPã€‚

> Hintï¼šæ¨é€²å‹•æ…‹è§£åŒ…å ´æ™¯æ“´å……çš„å…©å€‹ PEPï¼š
> - [PEP 3132 -- Extended Iterable Unpacking | Python.org](https://www.python.org/dev/peps/pep-3132/)
> - [PEP 448 -- Additional Unpacking Generalizations | Python.org](https://www.python.org/dev/peps/pep-0448/)

### 3. ä½¿ç”¨ next() å‡½å¼

`next()` æ˜¯ä¸€å€‹éå¸¸å¯¦ç”¨çš„å…§å»ºå‡½å¼ï¼Œå®ƒæ¥æ”¶ä¸€å€‹è¿­ä»£å™¨ä½œç‚ºå¼•æ•¸ï¼Œç„¶å¾Œè¿”å›è©²è¿­ä»£å™¨çš„ä¸‹ä¸€å€‹å…ƒç´ ã€‚ä½¿ç”¨å®ƒé…åˆç”Ÿæˆå™¨è¡¨ç¤ºå¼ï¼Œå¯ä»¥é«˜æ•ˆçš„å¯¦ç¾*â€œå¾åˆ—è¡¨ä¸­æŸ¥è©¢ç¬¬ä¸€å€‹æ»¿è¶³æ¢ä»¶çš„æˆå“¡â€* ä¹‹é¡çš„éœ€æ±‚ã€‚

```python
numbers = [3, 7, 8, 2, 21]
# ç²å–ä¸¦ **ç«‹å³è¿”å›** åˆ—è¡¨è£¡çš„ç¬¬ä¸€å€‹å¶æ•¸
print(next(i for i in numbers if i % 2 == 0))
# OUTPUT: 8
```

### 4. ä½¿ç”¨æœ‰åºå­—å…¸ä¾†å»é‡

å­—å…¸å’Œé›†åˆçš„çµæ§‹ç‰¹é»ä¿è­‰äº†å®ƒå€‘çš„æˆå“¡ä¸æœƒé‡è¤‡ï¼Œæ‰€ä»¥å®ƒå€‘ç¶“å¸¸è¢«ç”¨ä¾†å»é‡ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨å®ƒå€‘å€†å»é‡å¾Œçš„çµæœæœƒä¸Ÿå¤±åŸæœ‰åˆ—è¡¨çš„é †åºã€‚é€™æ˜¯ç”±åº•å±¤è³‡æ–™çµæ§‹â€œé›œæ¹Šè¡¨ï¼ˆHash Tableï¼‰â€çš„ç‰¹é»æ±ºå®šçš„ã€‚

```python
>>> l = [10, 2, 3, 21, 10, 3]
# å»é‡ä½†æ˜¯ä¸Ÿå¤±äº†é †åº
>>> set(l)
{3, 10, 2, 21}
```

å¦‚æœæ—¢éœ€è¦å»é‡åˆå¿…é ˆä¿ç•™é †åºæ€éº¼è¾¦ï¼Ÿæˆ‘å€‘å¯ä»¥ä½¿ç”¨ `collections.OrderedDict` æ¨¡çµ„:

```python
>>> from collections import OrderedDict
>>> list(OrderedDict.fromkeys(l).keys())
[10, 2, 3, 21]
```

> Hint: åœ¨ Python 3.6 ä¸­ï¼Œé è¨­çš„å­—å…¸å‹åˆ¥ä¿®æ”¹äº†å¯¦ç¾æ–¹å¼ï¼Œå·²ç¶“è®Šæˆæœ‰åºçš„äº†ã€‚ä¸¦ä¸”åœ¨ Python 3.7 ä¸­ï¼Œè©²åŠŸèƒ½å·²ç¶“å¾ **èªè¨€çš„å¯¦ç¾ç´°ç¯€** è®Šæˆäº†ç‚º **å¯ä¾è³´çš„æ­£å¼èªè¨€ç‰¹æ€§**ã€‚
> 
> ä½†æ˜¯æˆ‘è¦ºå¾—è®“æ•´å€‹ Python ç¤¾ç¾¤ç¿’æ…£é€™ä¸€é»é‚„éœ€è¦ä¸€äº›æ™‚é–“ï¼Œç•¢ç«Ÿç›®å‰â€œå­—å…¸æ˜¯ç„¡åºçš„â€é‚„æ˜¯è¢«å°åœ¨ç„¡æ•¸æœ¬ Python æ›¸ä¸Šã€‚æ‰€ä»¥ï¼Œæˆ‘ä»ç„¶å»ºè­°åœ¨ä¸€åˆ‡éœ€è¦æœ‰åºå­—å…¸çš„åœ°æ–¹ä½¿ç”¨ OrderedDictã€‚

## å¸¸è¦‹èª¤å€

### 1. ç•¶å¿ƒé‚£äº›å·²ç¶“æ¯ç«­çš„è¿­ä»£å™¨

åœ¨æ–‡ç« å‰é¢ï¼Œæˆ‘å€‘æåˆ°äº†ä½¿ç”¨â€œæ‡¶æƒ°â€ç”Ÿæˆå™¨çš„ç¨®ç¨®å¥½è™•ã€‚ä½†æ˜¯ï¼Œæ‰€æœ‰äº‹ç‰©éƒ½æœ‰å®ƒçš„å…©é¢æ€§ã€‚ç”Ÿæˆå™¨çš„æœ€å¤§çš„ç¼ºé»ä¹‹ä¸€å°±æ˜¯ï¼š**å®ƒæœƒæ¯ç«­**ã€‚ç•¶ä½ å®Œæ•´éæ­·éå®ƒå€‘å¾Œï¼Œä¹‹å¾Œçš„é‡è¤‡éæ­·å°±ä¸èƒ½æ‹¿åˆ°ä»»ä½•æ–°å…§å®¹äº†ã€‚

```python
numbers = [1, 2, 3]
numbers = (i * 2 for i in numbers)

# ç¬¬ä¸€æ¬¡è¿´åœˆæœƒè¼¸å‡º 2, 4, 6
for number in numbers:
    print(number)

# é€™æ¬¡è¿´åœˆä»€éº¼éƒ½ä¸æœƒè¼¸å‡ºï¼Œå› ç‚ºè¿­ä»£å™¨å·²ç¶“æ¯ç«­äº†
for number in numbers:
    print(number)
```

è€Œä¸”ä¸å…‰æ˜¯ç”Ÿæˆå™¨è¡¨ç¤ºå¼ï¼ŒPython 3 è£¡çš„ mapã€filter å…§å»ºå‡½å¼ä¹Ÿéƒ½æœ‰ä¸€æ¨£çš„ç‰¹é»ã€‚å¿½è¦–é€™å€‹ç‰¹é»å¾ˆå®¹æ˜“å°è‡´ç¨‹å¼ç¢¼ä¸­å‡ºç¾ä¸€äº›é›£ä»¥å¯Ÿè¦ºçš„ Bugã€‚

Instagram å°±åœ¨å°ˆæ¡ˆå¾ Python 2 åˆ° Python 3 çš„é·ç§»éç¨‹ä¸­ç¢°åˆ°äº†é€™å€‹å•é¡Œã€‚å®ƒå€‘åœ¨ PyCon 2017 ä¸Šåˆ†äº«äº†å°ä»˜é€™å€‹å•é¡Œçš„æ•…äº‹ã€‚è¨ªå•æ–‡ç«  [Instagram åœ¨ PyCon 2017 çš„æ¼”è¬›æ‘˜è¦](https://www.zlovezl.cn/articles/instagram-pycon-2017/)ï¼Œæœå°‹â€œè¿­ä»£å™¨â€å¯ä»¥æª¢è¦–è©³ç´°å…§å®¹ã€‚

### 2. åˆ¥åœ¨è¿´åœˆé«”å…§ä¿®æ”¹è¢«è¿­ä»£ç‰©ä»¶

é€™æ˜¯ä¸€å€‹å¾ˆå¤š Python åˆå­¸è€…æœƒçŠ¯çš„éŒ¯èª¤ã€‚æ¯”å¦‚ï¼Œæˆ‘å€‘éœ€è¦ä¸€å€‹å‡½å¼ä¾†åˆªæ‰åˆ—è¡¨è£¡çš„æ‰€æœ‰å¶æ•¸ï¼š

```python
def remove_even(numbers):
    """å»æ‰åˆ—è¡¨è£¡æ‰€æœ‰çš„å¶æ•¸
    """
    for i, number in enumerate(numbers):
        if number % 2 == 0:
            # æœ‰å•é¡Œçš„ç¨‹å¼ç¢¼
            del numbers[i]


numbers = [1, 2, 7, 4, 8, 11]
remove_even(numbers)
print(numbers)
# OUTPUT: [1, 7, 8, 11]
```

æ³¨æ„åˆ°çµæœè£¡é‚£å€‹å¤šå‡ºä¾†çš„ â€œ8â€ äº†å—ï¼Ÿç•¶ä½ åœ¨éæ­·ä¸€å€‹åˆ—è¡¨çš„åŒæ™‚ä¿®æ”¹å®ƒï¼Œå°±æœƒå‡ºç¾é€™æ¨£çš„äº‹æƒ…ã€‚å› ç‚ºè¢«è¿­ä»£çš„ç‰©ä»¶ `numbers` åœ¨è¿´åœˆéç¨‹ä¸­è¢«ä¿®æ”¹äº†ã€‚**éæ­·çš„ä¸‹æ¨™åœ¨ä¸æ–·å¢é•·ï¼Œè€Œåˆ—è¡¨æœ¬èº«çš„é•·åº¦åŒæ™‚åˆåœ¨ä¸æ–·ç¸®æ¸›ã€‚é€™æ¨£å°±æœƒå°è‡´åˆ—è¡¨è£¡çš„ä¸€äº›æˆå“¡å…¶å¯¦æ ¹æœ¬å°±æ²’æœ‰è¢«éæ­·åˆ°ã€‚**

æ‰€ä»¥å°æ–¼é€™é¡æ“ä½œï¼Œè«‹ä½¿ç”¨ä¸€å€‹æ–°çš„ç©ºåˆ—è¡¨å„²å­˜çµæœï¼Œæˆ–è€…åˆ©ç”¨ `yield` è¿”å›ä¸€å€‹ç”Ÿæˆå™¨ã€‚è€Œä¸æ˜¯ä¿®æ”¹è¢«è¿­ä»£çš„åˆ—è¡¨æˆ–æ˜¯å­—å…¸ç‰©ä»¶æœ¬èº«ã€‚

## ç¸½çµ

åœ¨é€™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å€‘é¦–å…ˆå¾â€œå®¹å™¨å‹åˆ¥â€çš„å®šç¾©å‡ºç™¼ï¼Œåœ¨åº•å±¤å’Œé«˜å±¤å…©å€‹å±¤é¢æ¢è¨äº†å®¹å™¨å‹åˆ¥ã€‚ä¹‹å¾Œéµå¾ªç³»åˆ—æ–‡ç« å‚³çµ±ï¼Œæä¾›äº†ä¸€äº›ç·¨å¯«å®¹å™¨ç›¸é—œç¨‹å¼ç¢¼æ™‚çš„æŠ€å·§ã€‚

è®“æˆ‘å€‘æœ€å¾Œå†ç¸½çµä¸€ä¸‹è¦é»ï¼š

- ç­è§£å®¹å™¨å‹åˆ¥çš„åº•å±¤å¯¦ç¾ï¼Œå¯ä»¥å¹«åŠ©ä½ å¯«å‡ºæ•ˆèƒ½æ›´å¥½çš„ç¨‹å¼ç¢¼
- æç…‰éœ€æ±‚è£¡çš„æŠ½è±¡æ¦‚å¿µï¼Œé¢å‘ä»‹é¢è€Œéå¯¦ç¾ç¨‹å¼è¨­è¨ˆ
- å¤šä½¿ç”¨â€œæ‡¶æƒ°â€çš„ç‰©ä»¶ï¼Œå°‘ç”Ÿæˆâ€œè¿«åˆ‡â€çš„åˆ—è¡¨
- ä½¿ç”¨å…ƒçµ„å’Œå­—å…¸å¯ä»¥ç°¡åŒ–åˆ†æ”¯ç¨‹å¼ç¢¼çµæ§‹
- ä½¿ç”¨ `next()` å‡½å¼é…åˆè¿­ä»£å™¨å¯ä»¥é«˜æ•ˆå®Œæˆå¾ˆå¤šäº‹æƒ…ï¼Œä½†æ˜¯ä¹Ÿéœ€è¦æ³¨æ„â€œæ¯ç«­â€å•é¡Œ
- collectionsã€itertools æ¨¡çµ„è£¡æœ‰éå¸¸å¤šæœ‰ç”¨çš„å·¥å…·ï¼Œå¿«å»çœ‹çœ‹å§ï¼

çœ‹å®Œæ–‡ç« çš„ä½ ï¼Œæœ‰æ²’æœ‰ä»€éº¼æƒ³åæ§½çš„ï¼Ÿè«‹ç•™è¨€æˆ–è€…åœ¨ [å°ˆæ¡ˆ Github Issues](https://github.com/piglei/one-python-craftsman) å‘Šè¨´æˆ‘å§ã€‚

[>>>ä¸‹ä¸€ç¯‡ã€5.è®“å‡½å¼è¿”å›çµæœçš„æŠ€å·§ã€‘](5-function-returning-tips.md)

[<<<ä¸Šä¸€ç¯‡ã€3.ä½¿ç”¨æ•¸å­—èˆ‡å­—ä¸²çš„æŠ€å·§ã€‘](3-tips-on-numbers-and-strings.md)

## ç³»åˆ—å…¶ä»–æ–‡ç« 

- [æ‰€æœ‰æ–‡ç« ç´¢å¼• [Github]](https://github.com/piglei/one-python-craftsman)
- [Python å·¥åŒ ï¼šå–„ç”¨è®Šæ•¸æ”¹å–„ç¨‹å¼ç¢¼è³ªé‡](https://www.zlovezl.cn/articles/python-using-variables-well/)
- [Python å·¥åŒ ï¼šç·¨å¯«æ¢ä»¶åˆ†æ”¯ç¨‹å¼ç¢¼çš„æŠ€å·§](https://www.zlovezl.cn/articles/python-else-block-secrets/)
- [Python å·¥åŒ ï¼šä½¿ç”¨æ•¸å­—èˆ‡å­—ä¸²çš„æŠ€å·§](https://www.zlovezl.cn/articles/tips-on-numbers-and-strings/)

## è¨»è§£

1. <a id="annot1"></a>Python é€™é–€èªè¨€é™¤äº† CPython å¤–ï¼Œé‚„æœ‰è¨±è¨±å¤šå¤šçš„å…¶ä»–ç‰ˆæœ¬å¯¦ç¾ã€‚å¦‚ç„¡ç‰¹åˆ¥èªªæ˜ï¼Œæœ¬æ–‡ä»¥åŠ â€œPython å·¥åŒ â€ ç³»åˆ—è£¡å‡ºç¾çš„æ‰€æœ‰ Python éƒ½ç‰¹æŒ‡ Python çš„ C èªè¨€å¯¦ç¾ CPython
2. <a id="annot2"></a>Python è£¡æ²’æœ‰é¡ä¼¼å…¶ä»–ç¨‹å¼èªè¨€è£¡çš„â€œInterface ä»‹é¢â€å‹åˆ¥ï¼Œåªæœ‰é¡ä¼¼çš„â€œæŠ½è±¡é¡â€æ¦‚å¿µã€‚ç‚ºäº†è¡¨é”æ–¹ä¾¿ï¼Œå¾Œé¢çš„å…§å®¹å‡çµ±ä¸€ä½¿ç”¨â€œä»‹é¢â€ä¾†æ›¿ä»£â€œæŠ½è±¡é¡â€ã€‚
3. <a id="annot3"></a>æœ‰æ²’æœ‰éš»å¯¦ç¾äº† Mapping ä½†åˆä¸æ˜¯ MutableMapping çš„å‹åˆ¥ï¼Ÿè©¦è©¦ [MappingProxyType({})](https://docs.python.org/3/library/types.html#types.MappingProxyType)
4. <a id="annot4"></a>æœ‰æ²’æœ‰éš»å¯¦ç¾äº† Set ä½†åˆä¸æ˜¯ MutableSet çš„å‹åˆ¥ï¼Ÿè©¦è©¦ [frozenset()](https://docs.python.org/3/library/stdtypes.html#frozenset)

